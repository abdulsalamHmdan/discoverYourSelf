<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختبار الذكاءات المتعددة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap');

        * {
            font-family: 'Tajawal', sans-serif;
        }

        .intelligence-icon {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .intelligence-icon:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
        }

        .progress-circle {
            transform: rotate(-90deg);
        }

        .breathing-circle {
            animation: breathe 8s infinite;
        }

        @keyframes breathe {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .question-transition {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .question-exit {
            opacity: 0;
            transform: translateX(-30px);
        }

        .question-enter {
            opacity: 0;
            transform: translateX(30px);
        }

        .question-active {
            opacity: 1;
            transform: translateX(0);
        }

        .tooltip {
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s;
        }

        .intelligence-icon:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }

        .drag-item {
            cursor: grab;
            transition: all 0.2s;
        }

        .drag-item:active {
            cursor: grabbing;
            transform: rotate(5deg);
        }

        .drop-zone {
            min-height: 100px;
            transition: all 0.3s;
        }

        .drop-zone.drag-over {
            background-color: #e0f2fe;
            border-color: #0284c7;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- شاشة البداية -->
    <div id="welcome-screen" class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- العنوان الرئيسي مع تأثيرات بصرية -->
        <div class="text-center mb-12 fade-in">
            <div class="relative">
                <h1
                    class="text-5xl md:text-7xl font-bold bg-gradient-to-r from-indigo-600 via-purple-600 to-blue-600 bg-clip-text text-transparent mb-6 leading-tight">
                    🧠 اكتشف ذكاءاتك المتعددة!</h1>
                <p class="text-xl md:text-4xl text-gray-700 leading-relaxed mb-6 font-medium">
                    👋 مرحبًا <%=name%> في المقياس الثالث: مقياس بصيرة للذكاءات المتعددة
                </p>
                <p class="text-xl md:text-2xl text-gray-700 leading-relaxed mb-6 font-medium">
                    هذا المقياس مبني على أبحاث علمية للعالم النفسي هوارد غاردنر، والتي أثبتت أن الذكاء ليس واحدًا، بل
                    مجموعة من القدرات المتنوعة التي يمتلكها كل شخص بدرجات مختلفة. </p>
                <p class="text-xl md:text-2xl text-gray-700 leading-relaxed mb-6 font-medium">
                    🎯 الغرض من المقياس: مساعدتك على اكتشاف مواطن قوتك وأساليب التعلم التي تناسبك، ليكون لديك وعي أوسع
                    بذاتك وإمكاناتك </p>
                <div class="absolute -top-4 -right-4 w-20 h-20 bg-yellow-200 rounded-full opacity-20 animate-pulse">
                </div>
                <div
                    class="absolute -bottom-4 -left-4 w-16 h-16 bg-pink-200 rounded-full opacity-20 animate-pulse delay-1000">
                </div>
            </div>

            <!-- بطاقة الوصف المحسنة -->
            <div
                class="bg-gradient-to-br from-white to-indigo-50 rounded-3xl shadow-2xl p-8 mb-8 border border-indigo-100">
                <div class="max-w-4xl mx-auto">
                    <p class="text-xl md:text-2xl text-gray-700 leading-relaxed mb-6 font-medium">
                        اكتشف أنماط ذكائك الثمانية واحصل على توصيات شخصية لطرق التعلم والأنشطة والتخصصات المناسبة لك
                    </p>

                    <!-- إحصائيات سريعة -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="bg-white rounded-2xl p-4 shadow-lg border-l-4 border-green-500">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                    <span class="text-2xl">⏱️</span>
                                </div>
                                <div>
                                    <div class="font-bold text-gray-800">10-15 دقائق</div>
                                    <div class="text-sm text-gray-600">مدة الاختبار</div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-2xl p-4 shadow-lg border-l-4 border-blue-500">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                                    <span class="text-2xl">🎯</span>
                                </div>
                                <div>
                                    <div class="font-bold text-gray-800">40 سؤال</div>
                                    <div class="text-sm text-gray-600">متنوع وتفاعلي</div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-2xl p-4 shadow-lg border-l-4 border-purple-500">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                                    <span class="text-2xl">✅</span>
                                </div>
                                <div>
                                    <div class="font-bold text-gray-800">لا توجد إجابات خاطئة</div>
                                    <div class="text-sm text-gray-600">كن صادقاً مع نفسك</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- شريط الذكاءات المحسن -->
        <div class="bg-gradient-to-br from-white to-gray-50 rounded-3xl shadow-2xl p-8 mb-8 border border-gray-100">
            <div class="text-center mb-8">
                <h3 class="text-3xl font-bold text-gray-800 mb-2">الذكاءات الثمانية</h3>
                <p class="text-gray-600">مرر الماوس على كل ذكاء لتتعرف عليه أكثر</p>
            </div>

            <div class="grid grid-cols-4 md:grid-cols-8 gap-3">
                <div class="intelligence-icon relative group" data-intelligence="linguistic">
                    <div
                        class="bg-gradient-to-br from-red-100 to-red-200 rounded-xl p-3 shadow-lg hover:shadow-2xl transform hover:scale-110 transition-all duration-300 border-2 border-red-200 hover:border-red-400">
                        <div class="text-3xl mb-2 text-center">📚</div>
                        <div class="text-xs font-bold text-center text-red-800">لغوي/لفظي</div>
                    </div>
                    <div
                        class="tooltip absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 bg-gray-900 text-white text-sm rounded-xl px-4 py-3 w-56 shadow-2xl z-10">
                        <div class="font-semibold mb-1">الذكاء اللغوي</div>
                        يميل للتعبير بالكلمات، القراءة والكتابة والقصص
                        <div
                            class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900">
                        </div>
                    </div>
                </div>

                <div class="intelligence-icon relative group" data-intelligence="logical">
                    <div
                        class="bg-gradient-to-br from-orange-100 to-orange-200 rounded-xl p-3 shadow-lg hover:shadow-2xl transform hover:scale-110 transition-all duration-300 border-2 border-orange-200 hover:border-orange-400">
                        <div class="text-3xl mb-2 text-center">🔢</div>
                        <div class="text-xs font-bold text-center text-orange-800">منطقي/رياضي</div>
                    </div>
                    <div
                        class="tooltip absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 bg-gray-900 text-white text-sm rounded-xl px-4 py-3 w-56 shadow-2xl z-10">
                        <div class="font-semibold mb-1">الذكاء المنطقي</div>
                        يحب الأرقام، الأنماط، الأسباب والنتائج، حل الألغاز
                        <div
                            class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900">
                        </div>
                    </div>
                </div>

                <div class="intelligence-icon relative group" data-intelligence="spatial">
                    <div
                        class="bg-gradient-to-br from-yellow-100 to-yellow-200 rounded-xl p-3 shadow-lg hover:shadow-2xl transform hover:scale-110 transition-all duration-300 border-2 border-yellow-200 hover:border-yellow-400">
                        <div class="text-3xl mb-2 text-center">🎨</div>
                        <div class="text-xs font-bold text-center text-yellow-800">بصري/مكاني</div>
                    </div>
                    <div
                        class="tooltip absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 bg-gray-900 text-white text-sm rounded-xl px-4 py-3 w-56 shadow-2xl z-10">
                        <div class="font-semibold mb-1">الذكاء البصري</div>
                        يتعلّم بالصور والخرائط والتخيل، قوي في الرسم والتصميم
                        <div
                            class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900">
                        </div>
                    </div>
                </div>

                <div class="intelligence-icon relative group" data-intelligence="bodily">
                    <div
                        class="bg-gradient-to-br from-green-100 to-green-200 rounded-xl p-3 shadow-lg hover:shadow-2xl transform hover:scale-110 transition-all duration-300 border-2 border-green-200 hover:border-green-400">
                        <div class="text-3xl mb-2 text-center">🏃</div>
                        <div class="text-xs font-bold text-center text-green-800">جسدي/حركي</div>
                    </div>
                    <div
                        class="tooltip absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 bg-gray-900 text-white text-sm rounded-xl px-4 py-3 w-56 shadow-2xl z-10">
                        <div class="font-semibold mb-1">الذكاء الحركي</div>
                        يتعلّم بالحركة واللمس والتجربة العملية والرياضة
                        <div
                            class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900">
                        </div>
                    </div>
                </div>

                <div class="intelligence-icon relative group" data-intelligence="musical">
                    <div
                        class="bg-gradient-to-br from-cyan-100 to-cyan-200 rounded-xl p-3 shadow-lg hover:shadow-2xl transform hover:scale-110 transition-all duration-300 border-2 border-cyan-200 hover:border-cyan-400">
                        <div class="text-3xl mb-2 text-center">🎵</div>
                        <div class="text-xs font-bold text-center text-cyan-800">إيقاعي</div>
                    </div>
                    <div
                        class="tooltip absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 bg-gray-900 text-white text-sm rounded-xl px-4 py-3 w-56 shadow-2xl z-10">
                        <div class="font-semibold mb-1">الذكاء الإيقاعي</div>
                        يلاحظ الأنماط والإيقاعات، يتعلم بالتكرار المنتظم
                        <div
                            class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900">
                        </div>
                    </div>
                </div>

                <div class="intelligence-icon relative group" data-intelligence="interpersonal">
                    <div
                        class="bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl p-3 shadow-lg hover:shadow-2xl transform hover:scale-110 transition-all duration-300 border-2 border-blue-200 hover:border-blue-400">
                        <div class="text-3xl mb-2 text-center">👥</div>
                        <div class="text-xs font-bold text-center text-blue-800">اجتماعي</div>
                    </div>
                    <div
                        class="tooltip absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 bg-gray-900 text-white text-sm rounded-xl px-4 py-3 w-56 shadow-2xl z-10">
                        <div class="font-semibold mb-1">الذكاء الاجتماعي</div>
                        يفهم الآخرين، يحب العمل الجماعي والتواصل
                        <div
                            class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900">
                        </div>
                    </div>
                </div>

                <div class="intelligence-icon relative group" data-intelligence="intrapersonal">
                    <div
                        class="bg-gradient-to-br from-purple-100 to-purple-200 rounded-xl p-3 shadow-lg hover:shadow-2xl transform hover:scale-110 transition-all duration-300 border-2 border-purple-200 hover:border-purple-400">
                        <div class="text-3xl mb-2 text-center">🎭</div>
                        <div class="text-xs font-bold text-center text-purple-800">ذاتي/شخصي</div>
                    </div>
                    <div
                        class="tooltip absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 bg-gray-900 text-white text-sm rounded-xl px-4 py-3 w-56 shadow-2xl z-10">
                        <div class="font-semibold mb-1">الذكاء الذاتي</div>
                        يعرف نفسه وأهدافه، يحب التأمل والتعلّم الذاتي
                        <div
                            class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900">
                        </div>
                    </div>
                </div>

                <div class="intelligence-icon relative group" data-intelligence="naturalist">
                    <div
                        class="bg-gradient-to-br from-emerald-100 to-emerald-200 rounded-xl p-3 shadow-lg hover:shadow-2xl transform hover:scale-110 transition-all duration-300 border-2 border-emerald-200 hover:border-emerald-400">
                        <div class="text-3xl mb-2 text-center">🌿</div>
                        <div class="text-xs font-bold text-center text-emerald-800">طبيعي/بيئي</div>
                    </div>
                    <div
                        class="tooltip absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 bg-gray-900 text-white text-sm rounded-xl px-4 py-3 w-56 shadow-2xl z-10">
                        <div class="font-semibold mb-1">الذكاء الطبيعي</div>
                        يرتاح في الطبيعة، يلاحظ الكائنات والأنماط البيئية
                        <div
                            class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- شرح طريقة الاختبار -->
        <div
            class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-3xl shadow-2xl p-8 mb-8 border border-amber-200">
            <div class="text-center mb-6">
                <h3 class="text-3xl font-bold text-amber-800 mb-2">🎯 كيف يعمل الاختبار؟</h3>
                <p class="text-amber-700 text-lg">اقرأ هذه النقاط المهمة قبل البدء</p>
            </div>

            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <!-- النقاط المهمة -->
                <div class="bg-white rounded-2xl p-6 shadow-lg border-l-4 border-green-500">
                    <h4 class="text-xl font-bold text-green-700 mb-4 flex items-center gap-2">
                        <span class="text-2xl">✅</span>
                        نقاط مهمة
                    </h4>
                    <ul class="space-y-3 text-gray-700">
                        <li class="flex items-start gap-3">
                            <span class="text-green-500 font-bold">•</span>
                            <span><strong>لا توجد إجابة صحيحة أو خاطئة</strong> - اختر ما يشبهك فعلاً</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="text-green-500 font-bold">•</span>
                            <span><strong>كن صادقاً مع نفسك</strong> - لا تختر ما تتمنى أن تكونه</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="text-green-500 font-bold">•</span>
                            <span><strong>فكر في سلوكك الطبيعي</strong> - ليس في المواقف الاستثنائية</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="text-green-500 font-bold">•</span>
                            <span><strong>لا تفكر كثيراً</strong> - الإجابة الأولى غالباً الأصدق</span>
                        </li>
                    </ul>
                </div>

                <!-- أنواع الأسئلة -->
                <div class="bg-white rounded-2xl p-6 shadow-lg border-l-4 border-blue-500">
                    <h4 class="text-xl font-bold text-blue-700 mb-4 flex items-center gap-2">
                        <span class="text-2xl">📝</span>
                        أنواع الأسئلة
                    </h4>
                    <ul class="space-y-3 text-gray-700">
                        <li class="flex items-start gap-3">
                            <span class="text-blue-500 font-bold">1.</span>
                            <span><strong>اختيار واحد:</strong> اختر الإجابة الأقرب لك</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="text-blue-500 font-bold">2.</span>
                            <span><strong>اختيار متعدد:</strong> اختر كل ما ينطبق عليك</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="text-blue-500 font-bold">3.</span>
                            <span><strong>ترتيب:</strong> اسحب العناصر لترتيبها حسب تفضيلك</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="text-blue-500 font-bold">4.</span>
                            <span><strong>تقييم بالنجوم:</strong> قيّم من 1-5 نجوم</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- تنبيهات مهمة -->
            <div class="bg-gradient-to-r from-red-50 to-pink-50 rounded-2xl p-6 border-2 border-red-200 mb-6">
                <h4 class="text-xl font-bold text-red-700 mb-4 flex items-center gap-2">
                    <span class="text-2xl">⚠️</span>
                    تنبيهات مهمة
                </h4>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="bg-white rounded-lg p-4 border border-red-200">
                        <h5 class="font-semibold text-red-600 mb-2">🚫 تجنب هذا:</h5>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>• اختيار ما يبدو "أفضل" أو "أذكى"</li>
                            <li>• التفكير في توقعات الآخرين</li>
                            <li>• محاولة الحصول على نتيجة معينة</li>
                        </ul>
                    </div>
                    <div class="bg-white rounded-lg p-4 border border-green-200">
                        <h5 class="font-semibold text-green-600 mb-2">✅ افعل هذا:</h5>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>• فكر في سلوكك اليومي الطبيعي</li>
                            <li>• اختر ما تستمتع به فعلاً</li>
                            <li>• كن صادقاً حتى لو بدا "عادياً"</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- معلومات إضافية -->
            <div class="bg-indigo-100 rounded-2xl p-6 text-center">
                <h4 class="text-lg font-bold text-indigo-800 mb-3">💡 معلومة مهمة</h4>
                <p class="text-indigo-700 leading-relaxed">
                    هذا الاختبار يقيس <strong>أنماط التعلم والميول الطبيعية</strong> وليس مستوى الذكاء العام (IQ).
                    كل شخص لديه مزيج فريد من الذكاءات، والهدف هو اكتشاف نقاط قوتك لتطويرها واستغلالها في التعلم والعمل.
                </p>
            </div>
        </div>

        <!-- قسم البداية المحسن -->
        <div class="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-3xl shadow-2xl p-8 border border-indigo-200">
            <div class="max-w-2xl mx-auto text-center">
                <div class="mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">🚀 جاهز لاكتشاف ذكاءاتك؟</h3>

                    <!-- معلومات سريعة -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                        <div class="bg-white rounded-xl p-4 shadow-md">
                            <div class="text-2xl mb-2">⏱️</div>
                            <div class="font-semibold text-gray-800">10-15 دقائق</div>
                            <div class="text-sm text-gray-600">مدة الاختبار</div>
                        </div>
                        <div class="bg-white rounded-xl p-4 shadow-md">
                            <div class="text-2xl mb-2">📊</div>
                            <div class="font-semibold text-gray-800">40 سؤال</div>
                            <div class="text-sm text-gray-600">متنوع وتفاعلي</div>
                        </div>
                        <div class="bg-white rounded-xl p-4 shadow-md">
                            <div class="text-2xl mb-2">🎯</div>
                            <div class="font-semibold text-gray-800">8 ذكاءات</div>
                            <div class="text-sm text-gray-600">تقييم شامل</div>
                        </div>
                    </div>
                </div>

                <button id="startBtn"
                    class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white px-12 py-5 rounded-2xl text-2xl font-bold cursor-pointer mb-6 transition-all duration-300 shadow-lg transform hover:scale-105">
                    🚀 ابدأ الاختبار الآن
                </button>

                <div class="flex justify-center gap-6 text-sm">
                    <button id="howItWorksBtn"
                        class="flex items-center gap-2 text-indigo-600 hover:text-indigo-800 font-medium transition-colors">
                        <span class="text-lg">❓</span>
                        تفاصيل إضافية
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- نافذة "التفاصيل الإضافية" -->
    <div id="howItWorksModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-3xl mx-4 max-h-96 overflow-y-auto">
            <h3 class="text-2xl font-bold text-indigo-800 mb-4">📋 تفاصيل إضافية عن الاختبار</h3>

            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <div>
                    <h4 class="font-bold text-green-700 mb-3">✅ ما يقيسه الاختبار:</h4>
                    <ul class="space-y-2 text-sm text-gray-700">
                        <li>• أنماط التعلم المفضلة لديك</li>
                        <li>• نقاط القوة الطبيعية في شخصيتك</li>
                        <li>• الأنشطة التي تستمتع بها أكثر</li>
                        <li>• المجالات المهنية المناسبة لك</li>
                        <li>• طرق التعلم الأكثر فعالية معك</li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-bold text-blue-700 mb-3">📊 ما ستحصل عليه:</h4>
                    <ul class="space-y-2 text-sm text-gray-700">
                        <li>• رسم بياني لجميع ذكاءاتك الثمانية</li>
                        <li>• ترتيب أعلى 3 ذكاءات لديك</li>
                        <li>• اقتراحات طرق تعلم مناسبة</li>
                        <li>• أنشطة وهوايات مقترحة</li>
                        <li>• مجالات مهنية تناسب ميولك</li>
                        <li>• تقرير قابل للطباعة والمشاركة</li>
                    </ul>
                </div>
            </div>

            <div class="bg-amber-50 border border-amber-200 rounded-lg p-4 mb-4">
                <h4 class="font-bold text-amber-800 mb-2">🎯 نصائح للحصول على أفضل النتائج:</h4>
                <ul class="text-sm text-amber-700 space-y-1">
                    <li>• أجب بناءً على سلوكك الطبيعي، ليس ما تتمناه</li>
                    <li>• لا تفكر في "الإجابة الصحيحة" - لا توجد إجابة خاطئة</li>
                    <li>• اختر الإجابة الأولى التي تخطر ببالك</li>
                    <li>• فكر في معظم المواقف، ليس الاستثناءات</li>
                </ul>
            </div>

            <div class="text-center">
                <button id="closeModalBtn"
                    class="bg-indigo-600 text-white px-8 py-3 rounded-lg hover:bg-indigo-700 transition-colors">
                    فهمت، أريد البدء
                </button>
            </div>
        </div>
    </div>

    <!-- نافذة تنبيه الاختبار غير المكتمل -->
    <div id="incompleteTestModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-lg mx-4">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-3xl">⚠️</span>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mb-2">الاختبار غير مكتمل</h3>
                <p class="text-gray-600" id="incompleteMessage">
                    <!-- سيتم إدراج الرسالة هنا -->
                </p>
            </div>

            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                <div class="flex items-start gap-3">
                    <span class="text-yellow-600 text-xl">💡</span>
                    <div class="text-sm text-yellow-800">
                        <p class="font-semibold mb-1">للحصول على أفضل النتائج:</p>
                        <p>يُنصح بإكمال جميع الأسئلة للحصول على تقييم دقيق وشامل لجميع أنواع الذكاءات الثمانية.</p>
                    </div>
                </div>
            </div>

            <div class="flex flex-col gap-3">
                <button id="continueTestFromModal"
                    class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors font-semibold">
                    📝 إكمال الأسئلة المتبقية (مُوصى به)
                </button>
                <button id="showPartialResults"
                    class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors">
                    📊 عرض النتائج الحالية
                </button>
                <button id="closeIncompleteModal" class="text-gray-600 hover:text-gray-800 underline text-sm">
                    إلغاء
                </button>
            </div>
        </div>
    </div>

    <!-- نافذة مراجعة الاختبار قبل التسليم -->
    <div id="reviewTestModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-2xl mx-4 max-h-96 overflow-y-auto">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-3xl">🎯</span>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mb-2">مراجعة الاختبار</h3>
                <p class="text-gray-600">تأكد من إجاباتك قبل عرض النتائج النهائية</p>
            </div>

            <!-- ملخص الإجابات -->
            <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6 mb-6 border border-green-200">
                <h4 class="text-lg font-bold text-green-800 mb-4 flex items-center gap-2">
                    <span class="text-xl">📊</span> ملخص إجاباتك
                </h4>
                <div id="reviewSummary" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- سيتم إدراج الملخص هنا -->
                </div>
            </div>

            <!-- الأسئلة غير المجابة (إن وجدت) -->
            <div id="unansweredSection" class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-6 hidden">
                <h4 class="font-bold text-yellow-800 mb-3 flex items-center gap-2">
                    <span class="text-xl">⚠️</span> أسئلة لم تتم الإجابة عليها
                </h4>
                <div id="unansweredList" class="text-sm text-yellow-700">
                    <!-- سيتم إدراج قائمة الأسئلة غير المجابة هنا -->
                </div>
            </div>

            <!-- نصائح أخيرة -->
            <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6">
                <h4 class="font-bold text-blue-800 mb-3 flex items-center gap-2">
                    <span class="text-xl">💡</span> تذكير أخير
                </h4>
                <ul class="text-sm text-blue-700 space-y-2">
                    <li class="flex items-start gap-2">
                        <span class="text-blue-500 font-bold">•</span>
                        <span>تأكد من أن إجاباتك تعكس سلوكك الطبيعي وليس ما تتمناه</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-blue-500 font-bold">•</span>
                        <span>يمكنك العودة لتعديل أي إجابة قبل عرض النتائج</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-blue-500 font-bold">•</span>
                        <span>النتائج ستكون أكثر دقة كلما كنت أكثر صدقاً</span>
                    </li>
                </ul>
            </div>

            <div class="flex flex-col gap-3">
                <button id="proceedToResults"
                    class="bg-green-600 text-white px-8 py-4 rounded-lg hover:bg-green-700 transition-colors font-bold text-lg">
                    🎯 عرض النتائج النهائية
                </button>
                <button id="reviewAnswers"
                    class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors font-semibold">
                    📝 مراجعة الإجابات
                </button>
                <button id="closeReviewModal" class="text-gray-600 hover:text-gray-800 underline text-sm">
                    إلغاء
                </button>
            </div>
        </div>
    </div>

    <!-- شاشة الدليل السريع -->
    <div id="onboarding-screen" class="hidden container mx-auto px-4 py-8 max-w-4xl">
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-indigo-800 mb-4">دليل سريع</h2>
            <p class="text-gray-600">نصائح مهمة قبل البدء</p>
        </div>

        <div class="grid md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white rounded-2xl shadow-lg p-6 text-center transform hover:scale-105 transition-transform">
                <div class="text-4xl mb-4">💯</div>
                <h3 class="text-xl font-semibold mb-3 text-indigo-800">اصدق مع نفسك</h3>
                <p class="text-gray-600">اختر ما يشبهك فعلًا؛ لا توجد إجابة صحيحة أو خاطئة</p>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6 text-center transform hover:scale-105 transition-transform">
                <div class="text-4xl mb-4">📊</div>
                <h3 class="text-xl font-semibold mb-3 text-indigo-800">تقدم واضح</h3>
                <p class="text-gray-600">سترى رقم السؤال، ونسبة التقدم، وكم تبقّى من الأسئلة</p>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6 text-center transform hover:scale-105 transition-transform">
                <div class="text-4xl mb-4">📋</div>
                <h3 class="text-xl font-semibold mb-3 text-indigo-800">تقرير مفيد</h3>
                <p class="text-gray-600">ستتعرف على أعلى ذكاءاتك، مع طرق تعلّم وتخصصات مناسبة لك</p>
            </div>
        </div>

        <div class="text-center">
            <button id="startTestBtn"
                class="bg-indigo-600 text-white px-8 py-4 rounded-lg text-xl font-semibold hover:bg-indigo-700 transition-colors">
                فهمت، لنبدأ
            </button>
        </div>
    </div>

    <!-- شاشة الأسئلة -->
    <div id="test-screen" class="hidden">
        <!-- شريط علوي ثابت -->
        <div class="bg-white shadow-md px-4 py-3 sticky top-0 z-40">
            <div class="container mx-auto flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <span class="font-semibold text-indigo-800">اختبار الذكاءات المتعددة</span>
                    <span class="w-2 h-2 bg-green-500 rounded-full" title="محفوظ تلقائيًا"></span>
                </div>

                <div class="flex items-center gap-4">
                    <div class="text-lg font-semibold">
                        <span id="currentQuestion">1</span> / 40
                    </div>
                    <div class="relative w-12 h-12">
                        <svg class="w-12 h-12 progress-circle">
                            <circle cx="24" cy="24" r="20" stroke="#e5e7eb" stroke-width="4" fill="none" />
                            <circle id="progressCircle" cx="24" cy="24" r="20" stroke="#4f46e5" stroke-width="4"
                                fill="none" stroke-dasharray="125.6" stroke-dashoffset="125.6" />
                        </svg>
                        <div
                            class="absolute inset-0 flex items-center justify-center text-xs font-bold text-indigo-600">
                            <span id="progressPercent">3%</span>
                        </div>
                    </div>
                </div>

                <div id="timer" class="text-sm text-gray-600 hidden">
                    ⏱️ <span id="timerDisplay">00:00</span>
                </div>
            </div>
        </div>

        <!-- شريط التقدم التفاعلي -->
        <div class="bg-gray-50 px-4 py-3">
            <div class="container mx-auto">
                <div id="progressTimeline" class="flex flex-wrap gap-1 justify-center">
                    <!-- سيتم إنشاؤها بـ JavaScript -->
                </div>
            </div>
        </div>

        <!-- محتوى السؤال -->
        <div class="container mx-auto px-4 py-8 max-w-4xl">
            <div class="bg-white rounded-2xl shadow-lg p-8">
                <!-- عنوان الذكاء الحالي -->
                <div class="text-center mb-6">
                    <div class="inline-flex items-center gap-3 bg-indigo-100 px-4 py-2 rounded-full">
                        <span id="currentIntelligenceIcon" class="text-2xl">📚</span>
                        <span id="currentIntelligenceName" class="font-semibold text-indigo-800">لغوي/لفظي</span>
                    </div>
                </div>

                <!-- شرح نوع السؤال -->
                <div id="questionTypeExplanation" class="mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <!-- سيتم إدراج شرح نوع السؤال هنا -->
                </div>

                <!-- السؤال -->
                <div id="questionContainer" class="mb-8">
                    <!-- سيتم إدراج السؤال هنا -->
                </div>

                <!-- سطر التقدم النصي -->
                <div class="text-center text-sm text-gray-600 mb-6">
                    <span id="progressText">تمت الإجابة على 0 من 40 · المتبقي: 40 سؤالًا</span>
                    <div id="autoSaveMessage" class="text-green-600 mt-2 opacity-0 transition-opacity">
                        تم الحفظ ✓
                    </div>
                </div>

                <!-- مؤشر الانتقال التلقائي -->
                <div id="autoAdvanceIndicator" class="text-center mb-4 opacity-0 transition-opacity duration-300">
                    <div class="inline-flex items-center gap-2 bg-green-100 text-green-800 px-4 py-2 rounded-full">
                        <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-sm font-medium">الانتقال للسؤال التالي...</span>
                    </div>
                </div>

                <!-- أزرار التنقل -->
                <div class="flex justify-between items-center">
                    <button id="prevBtn"
                        class="bg-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        رجوع
                    </button>

                    <div class="text-center">
                        <button id="goToUnansweredBtn"
                            class="bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors text-sm mb-2">
                            📝 الأسئلة غير المجابة
                        </button>
                        <div>
                            <button id="saveLaterBtn" class="text-indigo-600 hover:text-indigo-800 underline text-sm">
                                حفظ لاحقًا
                            </button>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">
                            💡 سينتقل تلقائياً بعد الإجابة
                        </div>
                    </div>

                    <div class="flex gap-3">
                        <button id="finishTestBtn"
                            class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-semibold hidden">
                            🏁 إنهاء الاختبار
                        </button>
                        <button id="nextBtn"
                            class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            التالي
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- استراحة منتصف الطريق -->
    <div id="midway-break"
        class="hidden fixed inset-0 bg-indigo-900 bg-opacity-95 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 text-center max-w-md mx-4">
            <h3 class="text-2xl font-bold text-indigo-800 mb-4">أحسنت! وصلت للنصف 🌟</h3>
            <p class="text-gray-600 mb-6">خذ نفسًا عميقًا واسترح قليلاً</p>

            <!-- تمرين التنفس -->
            <div class="mb-6">
                <div class="breathing-circle w-24 h-24 bg-indigo-200 rounded-full mx-auto mb-4"></div>
                <div id="breathingText" class="text-lg font-semibold text-indigo-600">شهيق... 4</div>
            </div>

            <button id="continueTestBtn"
                class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors">
                أكمل الاختبار
            </button>
        </div>
    </div>

    <!-- شاشة النتائج -->
    <div id="results-screen" class="hidden container mx-auto px-4 py-8 max-w-6xl">
        <div class="text-center mb-8">
            <h2 class="text-4xl font-bold text-indigo-800 mb-4">
                نتيجتك في الذكاءات المتعددة
            </h2>
            <p class="text-xl text-gray-600">مرحبًا <span id="resultUserName"
                    class="font-semibold text-indigo-600"></span>!</p>
        </div>

        <!-- ملخص نمط الذكاءات -->
        <div
            class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-2xl shadow-lg p-6 mb-8 border border-indigo-200">
            <h3 class="text-2xl font-bold text-center mb-6 text-indigo-800 flex items-center justify-center gap-3">
                <span class="text-3xl">🧠</span>
                نمط ذكاءاتك المتعددة
            </h3>
            <div id="intelligencePattern" class="text-center">
                <!-- سيتم إدراج نمط الذكاءات هنا -->
            </div>
        </div>

        <!-- أقل 3 ذكاءات - مجالات للتطوير -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
            <h3 class="text-2xl font-semibold text-center mb-6 flex items-center justify-center gap-3">
                <span class="text-3xl">📈</span>
                مجالات للتطوير والنمو
            </h3>
            <p class="text-center text-gray-600 mb-6">هذه الذكاءات تحتاج لمزيد من الاهتمام والتطوير</p>
            <div id="lowestIntelligences" class="grid md:grid-cols-3 gap-6">
                <!-- سيتم إدراج أقل 3 ذكاءات هنا -->
            </div>
        </div>

        <div class="grid lg:grid-cols-2 gap-8 mb-8">
            <!-- الرسم البياني -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h3 class="text-xl font-semibold text-center mb-4">توزيع ذكاءاتك</h3>
                <div class="relative">
                    <canvas id="resultsChart" width="400" height="400"></canvas>
                </div>
            </div>

            <!-- أعلى 3 ذكاءات -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h3 class="text-xl font-semibold text-center mb-4">أعلى ذكاءاتك</h3>
                <div id="topIntelligences" class="space-y-4">
                    <!-- سيتم إدراجها بـ JavaScript -->
                </div>
            </div>
        </div>

        <!-- التوصيات الشخصية -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
            <h3 class="text-2xl font-semibold text-center mb-6 flex items-center justify-center gap-3">
                <span class="text-3xl">🎯</span>
                توصيات شخصية لك
            </h3>
            <div id="personalRecommendations" class="grid md:grid-cols-2 gap-6">
                <!-- سيتم إدراجها بـ JavaScript -->
            </div>
        </div>

        <!-- خطة التطوير الشخصية -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
            <h3 class="text-2xl font-semibold text-center mb-6 flex items-center justify-center gap-3">
                <span class="text-3xl">📈</span>
                خطة التطوير الشخصية
            </h3>
            <div id="developmentPlan" class="grid md:grid-cols-2 gap-6">
                <!-- سيتم إدراجها بـ JavaScript -->
            </div>
        </div>

        <!-- التفاصيل الكاملة -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
            <h3 class="text-2xl font-semibold text-center mb-6">تفاصيل شاملة لكل ذكاء</h3>
            <div id="detailedResults" class="space-y-6">
                <!-- سيتم إدراجها بـ JavaScript -->
            </div>
        </div>

        <!-- أزرار الإجراءات -->
        <div class="flex flex-wrap justify-center gap-4">
            <button id="downloadPdfBtn"
                class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2">
                📄 تحميل PDF
            </button>
            <button id="retakeBtn"
                class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors">
                الانتقال الى صفحة التقييم
            </button>
        </div>
    </div>

    <script>
        // بيانات الاختبار
        const intelligences = {
            linguistic: { name: 'لغوي/لفظي', icon: '📚', color: '#ef4444' },
            logical: { name: 'منطقي/رياضي', icon: '🔢', color: '#f97316' },
            spatial: { name: 'بصري/مكاني', icon: '🎨', color: '#eab308' },
            bodily: { name: 'جسدي/حركي', icon: '🏃', color: '#22c55e' },
            musical: { name: 'إيقاعي', icon: '🎵', color: '#06b6d4' },
            interpersonal: { name: 'اجتماعي', icon: '👥', color: '#3b82f6' },
            intrapersonal: { name: 'ذاتي', icon: '🎭', color: '#8b5cf6' },
            naturalist: { name: 'طبيعي/بيئي', icon: '🌿', color: '#10b981' }
        };

        // تفاصيل شاملة لكل نوع ذكاء
        const intelligenceDetails = {
            linguistic: {
                description: 'يتميز الأشخاص ذوو الذكاء اللغوي بحبهم للكلمات والقراءة والكتابة. يتعلمون بشكل أفضل من خلال الاستماع والتحدث والقراءة، ولديهم قدرة عالية على التعبير عن أنفسهم بوضوح.',
                strengths: [
                    'التعبير الواضح والبليغ',
                    'حفظ المعلومات اللفظية بسهولة',
                    'فهم قواعد اللغة والنحو',
                    'الاستمتاع بالقراءة والكتابة',
                    'القدرة على الإقناع والتأثير بالكلمات'
                ],
                learningMethods: [
                    'القراءة بصوت عالٍ',
                    'كتابة الملاحظات والملخصات',
                    'المناقشات والحوارات',
                    'الاستماع للمحاضرات والبودكاست',
                    'استخدام الكلمات المفتاحية والمرادفات'
                ],
                activities: [
                    'كتابة اليوميات والقصص',
                    'قراءة الكتب والروايات',
                    'المشاركة في النقاشات الأدبية',
                    'تعلم لغات جديدة',
                    'كتابة الشعر والخواطر',
                    'المشاركة في المسابقات الثقافية'
                ],
                careers: [
                    'كاتب ومؤلف',
                    'صحفي ومراسل',
                    'مترجم',
                    'محامي',
                    'مدرس لغة',
                    'محرر ومدقق لغوي',
                    'مذيع إذاعي وتلفزيوني',
                    'شاعر وأديب'
                ]
            },
            logical: {
                description: 'يتميز أصحاب الذكاء المنطقي بحبهم للأرقام والأنماط والتحليل المنطقي. يستمتعون بحل المشكلات المعقدة ويفضلون التفكير المنهجي والمنطقي في جميع جوانب الحياة.',
                strengths: [
                    'التفكير التحليلي والمنطقي',
                    'حل المشكلات المعقدة',
                    'فهم الأنماط والعلاقات',
                    'العمل مع الأرقام والإحصائيات',
                    'التخطيط المنهجي والتنظيم'
                ],
                learningMethods: [
                    'حل المسائل والتمارين العملية',
                    'استخدام الرسوم البيانية والجداول',
                    'التعلم خطوة بخطوة',
                    'ربط المعلومات بالأسباب والنتائج',
                    'استخدام الأمثلة الرقمية والإحصائية'
                ],
                activities: [
                    'حل الألغاز والأحاجي الرياضية',
                    'لعب الشطرنج والألعاب الاستراتيجية',
                    'البرمجة وتطوير التطبيقات',
                    'إجراء التجارب العلمية',
                    'تحليل البيانات والإحصائيات',
                    'دراسة الفلسفة والمنطق'
                ],
                careers: [
                    'مهندس',
                    'عالم رياضيات',
                    'محاسب ومحلل مالي',
                    'مبرمج ومطور برمجيات',
                    'عالم فيزياء أو كيمياء',
                    'محلل بيانات',
                    'باحث علمي',
                    'مستشار إداري'
                ]
            },
            spatial: {
                description: 'يتميز أصحاب الذكاء البصري المكاني بقدرتهم على التفكير بالصور والأشكال. يتعلمون بشكل أفضل من خلال الرؤية والتخيل، ولديهم حس فني قوي وقدرة على تصور الأشياء في الفضاء.',
                strengths: [
                    'التفكير البصري والتخيل',
                    'فهم الخرائط والمخططات',
                    'الحس الفني والجمالي',
                    'تذكر الوجوه والأماكن',
                    'القدرة على التصميم والإبداع البصري'
                ],
                learningMethods: [
                    'استخدام الصور والرسوم التوضيحية',
                    'عمل الخرائط الذهنية',
                    'التعلم بالألوان والرموز',
                    'مشاهدة الفيديوهات التعليمية',
                    'استخدام النماذج ثلاثية الأبعاد'
                ],
                activities: [
                    'الرسم والتصوير',
                    'التصميم الجرافيكي',
                    'النحت والأعمال الفنية',
                    'التصوير الفوتوغرافي',
                    'بناء النماذج والمجسمات',
                    'ترتيب وتنسيق المساحات'
                ],
                careers: [
                    'مصمم جرافيك',
                    'مهندس معماري',
                    'فنان تشكيلي',
                    'مصور فوتوغرافي',
                    'مصمم داخلي',
                    'رسام كاريكاتير',
                    'مخرج سينمائي',
                    'مصمم ألعاب'
                ]
            },
            bodily: {
                description: 'يتميز أصحاب الذكاء الجسدي الحركي بحبهم للحركة والنشاط البدني. يتعلمون بشكل أفضل من خلال التجربة العملية واستخدام أجسامهم، ولديهم مهارات حركية متقدمة وتناسق جيد.',
                strengths: [
                    'التناسق الحركي والمهارات البدنية',
                    'التعلم من خلال التجربة العملية',
                    'استخدام اليدين بمهارة',
                    'التعبير بلغة الجسد',
                    'ردود الفعل السريعة والدقيقة'
                ],
                learningMethods: [
                    'التعلم بالممارسة والتجربة',
                    'الحركة أثناء الدراسة',
                    'استخدام الأدوات والمواد الملموسة',
                    'التعلم في الهواء الطلق',
                    'الأنشطة التفاعلية والعملية'
                ],
                activities: [
                    'ممارسة الرياضة والألعاب',
                    'الرقص والحركات الإيقاعية',
                    'الأعمال اليدوية والحرف',
                    'الطبخ والخبز',
                    'البستنة والزراعة',
                    'التمثيل والأداء المسرحي'
                ],
                careers: [
                    'رياضي محترف',
                    'مدرب رياضي',
                    'راقص أو مصمم رقصات',
                    'جراح',
                    'حرفي ماهر',
                    'طبيب علاج طبيعي',
                    'ممثل',
                    'طيار'
                ]
            },
            musical: {
                description: 'يتميز أصحاب الذكاء الإيقاعي بحساسيتهم للأصوات والإيقاعات والأنماط المنتظمة. يحبون النظام والتكرار المنتظم، ويتعلمون بشكل أفضل في بيئة منظمة ومنتظمة.',
                strengths: [
                    'ملاحظة الأنماط والإيقاعات',
                    'الحساسية للأصوات والنغمات',
                    'التنظيم والترتيب المنهجي',
                    'التعلم بالتكرار المنتظم',
                    'إدارة الوقت والجداول الزمنية'
                ],
                learningMethods: [
                    'التعلم بالإيقاع والتكرار',
                    'استخدام الجداول الزمنية المنتظمة',
                    'التعلم في بيئة هادئة ومنظمة',
                    'ربط المعلومات بالأنماط',
                    'استخدام الأصوات والنغمات في التعلم'
                ],
                activities: [
                    'الاستماع للموسيقى والأصوات الطبيعية',
                    'تنظيم الأعمال بجداول زمنية',
                    'ممارسة التمارين بإيقاع منتظم',
                    'تعلم الآلات الموسيقية',
                    'إنشاء قوائم وجداول منظمة',
                    'ممارسة التأمل والاسترخاء'
                ],
                careers: [
                    'موسيقي أو عازف',
                    'منظم فعاليات',
                    'مدير مشاريع',
                    'محاسب',
                    'مدرب تنمية بشرية',
                    'مهندس صوت',
                    'مدير إداري',
                    'مطور أنظمة'
                ]
            },
            interpersonal: {
                description: 'يتميز أصحاب الذكاء الاجتماعي بقدرتهم على فهم الآخرين والتواصل معهم بفعالية. يحبون العمل الجماعي ولديهم مهارات قيادية وتأثير إيجابي على من حولهم.',
                strengths: [
                    'فهم مشاعر ودوافع الآخرين',
                    'التواصل الفعال والإقناع',
                    'القيادة والتأثير الإيجابي',
                    'بناء العلاقات القوية',
                    'حل النزاعات والوساطة'
                ],
                learningMethods: [
                    'التعلم في مجموعات',
                    'المناقشات والحوارات',
                    'التعلم التعاوني والتشاركي',
                    'لعب الأدوار والمحاكاة',
                    'التعلم من خلال التدريس للآخرين'
                ],
                activities: [
                    'المشاركة في الأنشطة الجماعية',
                    'تنظيم الفعاليات الاجتماعية',
                    'العمل التطوعي والخيري',
                    'التدريب والتوجيه',
                    'المشاركة في النوادي والجمعيات',
                    'ممارسة الألعاب الجماعية'
                ],
                careers: [
                    'مدير موارد بشرية',
                    'مستشار نفسي أو اجتماعي',
                    'مدرس أو مدرب',
                    'مندوب مبيعات',
                    'سياسي أو دبلوماسي',
                    'مدير تسويق',
                    'منسق اجتماعي',
                    'مذيع أو إعلامي'
                ]
            },
            intrapersonal: {
                description: 'يتميز أصحاب الذكاء الذاتي بفهمهم العميق لأنفسهم ومشاعرهم وأهدافهم. يحبون التأمل والتفكر، ولديهم قدرة عالية على التحليل الذاتي والتطوير الشخصي.',
                strengths: [
                    'الوعي الذاتي والفهم العميق للنفس',
                    'إدارة المشاعر والانفعالات',
                    'وضع الأهداف والتخطيط الشخصي',
                    'التأمل والتفكر العميق',
                    'الاستقلالية في التعلم والعمل'
                ],
                learningMethods: [
                    'التعلم الذاتي والفردي',
                    'التأمل والتفكر في المعلومات',
                    'ربط التعلم بالأهداف الشخصية',
                    'كتابة اليوميات والتأملات',
                    'التعلم في بيئة هادئة ومنعزلة'
                ],
                activities: [
                    'كتابة اليوميات والتأملات الشخصية',
                    'ممارسة التأمل والاسترخاء',
                    'وضع الأهداف والخطط الشخصية',
                    'القراءة في التطوير الذاتي',
                    'ممارسة الهوايات الفردية',
                    'السفر والاستكشاف الذاتي'
                ],
                careers: [
                    'كاتب أو مؤلف',
                    'مستشار شخصي',
                    'باحث أو عالم',
                    'فيلسوف أو مفكر',
                    'مدرب تنمية ذاتية',
                    'رائد أعمال',
                    'فنان مستقل',
                    'محلل نفسي'
                ]
            },
            naturalist: {
                description: 'يتميز أصحاب الذكاء الطبيعي بحبهم للطبيعة والبيئة. لديهم قدرة على ملاحظة وفهم الأنماط الطبيعية، ويشعرون بالراحة والسلام في البيئات الطبيعية.',
                strengths: [
                    'ملاحظة وفهم الأنماط الطبيعية',
                    'الحساسية للتغيرات البيئية',
                    'تصنيف وتمييز الكائنات الحية',
                    'فهم النظم البيئية والطبيعية',
                    'الاهتمام بالقضايا البيئية'
                ],
                learningMethods: [
                    'التعلم في البيئات الطبيعية',
                    'استخدام أمثلة من الطبيعة',
                    'الملاحظة المباشرة والاستكشاف',
                    'التصنيف والمقارنة',
                    'ربط التعلم بالقضايا البيئية'
                ],
                activities: [
                    'زراعة النباتات والبستنة',
                    'مراقبة الطيور والحيوانات',
                    'التخييم والرحلات الطبيعية',
                    'جمع العينات الطبيعية',
                    'التصوير الطبيعي',
                    'المشاركة في حملات حماية البيئة'
                ],
                careers: [
                    'عالم أحياء أو بيئة',
                    'مهندس زراعي',
                    'طبيب بيطري',
                    'مرشد سياحي طبيعي',
                    'باحث في علوم الأرض',
                    'مصمم حدائق',
                    'ناشط بيئي',
                    'عالم جيولوجيا'
                ]
            }
        };

        const questions = [
            // الذكاء اللغوي والمنطقي - اختيار من متعدد (single)
            {
                type: 'linguistic',
                questionType: 'single',
                question: 'عندما تذاكر، أي أسلوب تفضّل؟',
                options: [
                    { text: 'قراءة ملخّصات وكتب', value: 4 },
                    { text: 'مشاهدة فيديو تعليمي', value: 1 },
                    { text: 'عمل مخطط بصري', value: 1 },
                    { text: 'مناقشة مع صديق', value: 2 }
                ]
            },
            {
                type: 'linguistic',
                questionType: 'single',
                question: 'إذا طُلب منك شرح فكرة، ماذا تفعل أولاً؟',
                options: [
                    { text: 'أكتب النقاط الرئيسية', value: 4 },
                    { text: 'أرسم مخططاً', value: 1 },
                    { text: 'أعطي مثالاً عملياً', value: 2 },
                    { text: 'أستخدم الإيماءات', value: 1 }
                ]
            },
            {
                type: 'linguistic',
                questionType: 'single',
                question: 'أي من هذه الأنشطة تفضل في وقت فراغك؟',
                options: [
                    { text: 'قراءة الروايات والكتب', value: 4 },
                    { text: 'مشاهدة الأفلام', value: 2 },
                    { text: 'ممارسة الرياضة', value: 1 },
                    { text: 'الاستماع للموسيقى', value: 1 }
                ]
            },
            {
                type: 'linguistic',
                questionType: 'single',
                question: 'عند تعلم معلومة جديدة، كيف تحفظها؟',
                options: [
                    { text: 'أكررها بصوت عالٍ', value: 4 },
                    { text: 'أرسم مخططاً لها', value: 1 },
                    { text: 'أربطها بحركة', value: 1 },
                    { text: 'أحفظها كما هي', value: 2 }
                ]
            },
            {
                type: 'linguistic',
                questionType: 'single',
                question: 'ما الذي يجذبك أكثر في الكتب؟',
                options: [
                    { text: 'أسلوب الكاتب وجمال اللغة', value: 4 },
                    { text: 'المعلومات والحقائق', value: 2 },
                    { text: 'الصور والرسوم التوضيحية', value: 1 },
                    { text: 'القصص والأحداث', value: 3 }
                ]
            },

            {
                type: 'logical',
                questionType: 'single',
                question: 'ما النمط التالي في هذه السلسلة: 2، 4، 8، 16، ؟',
                options: [
                    { text: '24', value: 1 },
                    { text: '32', value: 4 },
                    { text: '20', value: 1 },
                    { text: '18', value: 1 }
                ]
            },
            {
                type: 'logical',
                questionType: 'single',
                question: 'عند حل مشكلة، أي طريقة تفضل؟',
                options: [
                    { text: 'تحليل الأسباب والنتائج', value: 4 },
                    { text: 'الاعتماد على الحدس', value: 1 },
                    { text: 'تجربة حلول مختلفة', value: 2 },
                    { text: 'سؤال الآخرين', value: 1 }
                ]
            },
            {
                type: 'logical',
                questionType: 'single',
                question: 'إذا كان كل A هو B، وكل B هو C، فإن:',
                options: [
                    { text: 'كل A هو C', value: 4 },
                    { text: 'كل C هو A', value: 1 },
                    { text: 'بعض A هو C', value: 2 },
                    { text: 'لا يمكن تحديد العلاقة', value: 1 }
                ]
            },
            {
                type: 'logical',
                questionType: 'single',
                question: 'أي من هذه المواد الدراسية تستمتع بها أكثر؟',
                options: [
                    { text: 'الرياضيات والفيزياء', value: 4 },
                    { text: 'اللغة والأدب', value: 1 },
                    { text: 'الفنون والرسم', value: 1 },
                    { text: 'التاريخ والجغرافيا', value: 2 }
                ]
            },
            {
                type: 'logical',
                questionType: 'single',
                question: 'عند اتخاذ قرار مهم، ما أول ما تفعله؟',
                options: [
                    { text: 'أجمع المعلومات وأحللها', value: 4 },
                    { text: 'أستشير الآخرين', value: 1 },
                    { text: 'أتبع مشاعري', value: 1 },
                    { text: 'أفكر في النتائج المحتملة', value: 3 }
                ]
            },

            // الذكاء البصري والحركي - اختيار متعدد (multiple)
            {
                type: 'spatial',
                questionType: 'multiple',
                question: 'أي من هذه الأنشطة تجذبك؟ (اختر كل ما ينطبق)',
                options: [
                    { text: 'الرسم والتصميم', value: 4 },
                    { text: 'التصوير الفوتوغرافي', value: 3 },
                    { text: 'ترتيب الأثاث', value: 3 },
                    { text: 'بناء النماذج', value: 4 }
                ]
            },
            {
                type: 'spatial',
                questionType: 'multiple',
                question: 'ما الذي يساعدك في التعلم؟ (اختر كل ما ينطبق)',
                options: [
                    { text: 'الرسوم التوضيحية والمخططات', value: 4 },
                    { text: 'الخرائط الذهنية', value: 4 },
                    { text: 'الألوان والتمييز البصري', value: 3 },
                    { text: 'النماذج ثلاثية الأبعاد', value: 4 }
                ]
            },
            {
                type: 'spatial',
                questionType: 'multiple',
                question: 'أي من هذه المهارات تجيدها؟ (اختر كل ما ينطبق)',
                options: [
                    { text: 'تذكر الوجوه والأماكن', value: 3 },
                    { text: 'قراءة الخرائط بسهولة', value: 4 },
                    { text: 'تخيل الأشكال من زوايا مختلفة', value: 4 },
                    { text: 'ملاحظة التفاصيل البصرية', value: 3 }
                ]
            },
            {
                type: 'spatial',
                questionType: 'multiple',
                question: 'ما الذي تلاحظه أولاً في مكان جديد؟ (اختر كل ما ينطبق)',
                options: [
                    { text: 'الألوان والديكور', value: 4 },
                    { text: 'ترتيب الأثاث والمساحات', value: 4 },
                    { text: 'الإضاءة والظلال', value: 3 },
                    { text: 'التناسق والتصميم العام', value: 4 }
                ]
            },
            {
                type: 'spatial',
                questionType: 'multiple',
                question: 'أي من هذه الأدوات تستخدمها كثيراً؟ (اختر كل ما ينطبق)',
                options: [
                    { text: 'برامج التصميم والرسم', value: 4 },
                    { text: 'الكاميرا للتصوير', value: 3 },
                    { text: 'أدوات الرسم التقليدية', value: 4 },
                    { text: 'تطبيقات التصميم على الهاتف', value: 3 }
                ]
            },

            {
                type: 'bodily',
                questionType: 'multiple',
                question: 'أي من هذه الأنشطة تستمتع بها؟ (اختر كل ما ينطبق)',
                options: [
                    { text: 'الرياضة والألعاب', value: 4 },
                    { text: 'الأعمال اليدوية', value: 4 },
                    { text: 'الرقص', value: 3 },
                    { text: 'الطبخ', value: 3 }
                ]
            },
            {
                type: 'bodily',
                questionType: 'multiple',
                question: 'كيف تفضل التعلم؟ (اختر كل ما ينطبق)',
                options: [
                    { text: 'التجربة العملية والممارسة', value: 4 },
                    { text: 'الحركة أثناء الدراسة', value: 4 },
                    { text: 'استخدام اليدين في التعلم', value: 4 },
                    { text: 'التعلم في الهواء الطلق', value: 3 }
                ]
            },
            {
                type: 'bodily',
                questionType: 'multiple',
                question: 'أي من هذه المهارات تجيدها؟ (اختر كل ما ينطبق)',
                options: [
                    { text: 'التوازن والتناسق الحركي', value: 4 },
                    { text: 'استخدام الأدوات بمهارة', value: 4 },
                    { text: 'التعبير بلغة الجسد', value: 3 },
                    { text: 'ردود الفعل السريعة', value: 3 }
                ]
            },
            {
                type: 'bodily',
                questionType: 'multiple',
                question: 'متى تشعر بالراحة أكثر؟ (اختر كل ما ينطبق)',
                options: [
                    { text: 'عند الحركة والنشاط', value: 4 },
                    { text: 'أثناء العمل بيديك', value: 4 },
                    { text: 'في الأماكن المفتوحة', value: 3 },
                    { text: 'عند ممارسة الرياضة', value: 4 }
                ]
            },
            {
                type: 'bodily',
                questionType: 'multiple',
                question: 'أي بيئة عمل تفضل؟ (اختر كل ما ينطبق)',
                options: [
                    { text: 'ورشة عمل أو مختبر', value: 4 },
                    { text: 'في الهواء الطلق', value: 4 },
                    { text: 'صالة رياضية', value: 3 },
                    { text: 'مكان يسمح بالحركة', value: 4 }
                ]
            },

            // الذكاء الإيقاعي والاجتماعي - ترتيب (ranking)
            {
                type: 'musical',
                questionType: 'ranking',
                question: 'رتّب هذه الأنشطة الإيقاعية حسب استمتاعك بها (الأول الأكثر تفضيلاً):',
                options: [
                    { text: 'التصفيق على الإيقاع', value: 0 },
                    { text: 'المشي بخطوات منتظمة', value: 0 },
                    { text: 'تنظيم الأعمال بجدول زمني', value: 0 },
                    { text: 'ممارسة التمارين بإيقاع ثابت', value: 0 }
                ]
            },
            {
                type: 'musical',
                questionType: 'ranking',
                question: 'رتّب هذه طرق التعلم حسب فعاليتها معك:',
                options: [
                    { text: 'التكرار المنتظم', value: 0 },
                    { text: 'الجداول الزمنية المحددة', value: 0 },
                    { text: 'الأنماط والتسلسلات', value: 0 },
                    { text: 'الإيقاع في الحفظ', value: 0 }
                ]
            },
            {
                type: 'musical',
                questionType: 'ranking',
                question: 'رتّب هذه البيئات حسب تركيزك فيها:',
                options: [
                    { text: 'مكان هادئ ومنتظم', value: 0 },
                    { text: 'بيئة بها أصوات طبيعية منتظمة', value: 0 },
                    { text: 'مكان به إيقاع خفيف في الخلفية', value: 0 },
                    { text: 'بيئة صامتة تماماً', value: 0 }
                ]
            },
            {
                type: 'musical',
                questionType: 'ranking',
                question: 'رتّب هذه الأنشطة حسب قدرتك على ملاحظة الأنماط فيها:',
                options: [
                    { text: 'الأرقام والتسلسلات', value: 0 },
                    { text: 'الحركات المتكررة', value: 0 },
                    { text: 'الأصوات والإيقاعات', value: 0 },
                    { text: 'الألوان والأشكال', value: 0 }
                ]
            },
            {
                type: 'musical',
                questionType: 'ranking',
                question: 'رتّب هذه المهارات حسب قوتك فيها:',
                options: [
                    { text: 'تذكر التسلسلات والخطوات', value: 0 },
                    { text: 'الالتزام بالمواعيد والجداول', value: 0 },
                    { text: 'ملاحظة الأنماط المتكررة', value: 0 },
                    { text: 'تنظيم الأعمال بطريقة منهجية', value: 0 }
                ]
            },

            {
                type: 'interpersonal',
                questionType: 'ranking',
                question: 'رتّب هذه الأنشطة الاجتماعية حسب استمتاعك بها:',
                options: [
                    { text: 'العمل التطوعي', value: 0 },
                    { text: 'تنظيم الفعاليات', value: 0 },
                    { text: 'التدريس والتوجيه', value: 0 },
                    { text: 'حل النزاعات', value: 0 }
                ]
            },
            {
                type: 'interpersonal',
                questionType: 'ranking',
                question: 'رتّب هذه المهارات حسب قوتك فيها:',
                options: [
                    { text: 'فهم مشاعر الآخرين', value: 0 },
                    { text: 'التواصل الفعال', value: 0 },
                    { text: 'القيادة والتأثير', value: 0 },
                    { text: 'بناء العلاقات', value: 0 }
                ]
            },
            {
                type: 'interpersonal',
                questionType: 'ranking',
                question: 'رتّب هذه البيئات حسب راحتك فيها:',
                options: [
                    { text: 'الاجتماعات الكبيرة', value: 0 },
                    { text: 'المجموعات الصغيرة', value: 0 },
                    { text: 'المحادثات الثنائية', value: 0 },
                    { text: 'العمل الفردي', value: 0 }
                ]
            },
            {
                type: 'interpersonal',
                questionType: 'ranking',
                question: 'رتّب هذه الأدوار حسب تفضيلك في العمل الجماعي:',
                options: [
                    { text: 'قائد الفريق', value: 0 },
                    { text: 'منسق المشروع', value: 0 },
                    { text: 'مولد الأفكار', value: 0 },
                    { text: 'منفذ المهام', value: 0 }
                ]
            },
            {
                type: 'interpersonal',
                questionType: 'ranking',
                question: 'رتّب هذه الطرق حسب تفضيلك لحل المشاكل:',
                options: [
                    { text: 'النقاش الجماعي', value: 0 },
                    { text: 'استشارة الخبراء', value: 0 },
                    { text: 'العصف الذهني', value: 0 },
                    { text: 'التفكير المنفرد', value: 0 }
                ]
            },

            // الذكاء الذاتي والطبيعي - تقييم بالنجوم (rating)
            {
                type: 'intrapersonal',
                questionType: 'rating',
                question: 'قيّم مدى انطباق هذه العبارات عليك (1-5 نجوم):',
                statements: [
                    { text: 'أعرف نقاط قوتي وضعفي جيداً', value: 0 },
                    { text: 'أحتاج وقتاً وحيداً للتفكير', value: 0 },
                    { text: 'أفهم مشاعري وأسبابها', value: 0 },
                    { text: 'أثق بحدسي الداخلي', value: 0 }
                ]
            },
            {
                type: 'intrapersonal',
                questionType: 'rating',
                question: 'قيّم مدى ممارستك لهذه الأنشطة (1-5 نجوم):',
                statements: [
                    { text: 'كتابة اليوميات والتأملات', value: 0 },
                    { text: 'وضع أهداف شخصية', value: 0 },
                    { text: 'التأمل والتفكر', value: 0 },
                    { text: 'مراجعة أخطائي وتعلم منها', value: 0 }
                ]
            },
            {
                type: 'intrapersonal',
                questionType: 'rating',
                question: 'قيّم مدى صحة هذه الصفات عنك (1-5 نجوم):',
                statements: [
                    { text: 'أحب العمل بمفردي', value: 0 },
                    { text: 'أحلل تصرفاتي باستمرار', value: 0 },
                    { text: 'أستمتع بالتعلم الذاتي', value: 0 },
                    { text: 'أفهم قيمي ومبادئي جيداً', value: 0 }
                ]
            },
            {
                type: 'intrapersonal',
                questionType: 'rating',
                question: 'قيّم مدى راحتك في هذه المواقف (1-5 نجوم):',
                statements: [
                    { text: 'قضاء يوم كامل وحيداً', value: 0 },
                    { text: 'التفكير في معنى الحياة', value: 0 },
                    { text: 'اتخاذ قرارات مهمة بمفردي', value: 0 },
                    { text: 'التعبير عن مشاعري الداخلية', value: 0 }
                ]
            },
            {
                type: 'intrapersonal',
                questionType: 'rating',
                question: 'قيّم قوتك في هذه المهارات الذاتية (1-5 نجوم):',
                statements: [
                    { text: 'معرفة ما يحفزني ويثبطني', value: 0 },
                    { text: 'إدارة وقتي وأولوياتي', value: 0 },
                    { text: 'التحكم في انفعالاتي', value: 0 },
                    { text: 'تطوير نفسي باستمرار', value: 0 }
                ]
            },

            {
                type: 'naturalist',
                questionType: 'rating',
                question: 'قيّم مدى استمتاعك بهذه الأنشطة الطبيعية (1-5 نجوم):',
                statements: [
                    { text: 'زراعة النباتات والعناية بها', value: 0 },
                    { text: 'مراقبة الطيور والحيوانات', value: 0 },
                    { text: 'التخييم في الطبيعة', value: 0 },
                    { text: 'جمع الأحجار والأصداف', value: 0 }
                ]
            },
            {
                type: 'naturalist',
                questionType: 'rating',
                question: 'قيّم مدى راحتك في هذه البيئات (1-5 نجوم):',
                statements: [
                    { text: 'الغابات والحدائق الطبيعية', value: 0 },
                    { text: 'الشواطئ والبحيرات', value: 0 },
                    { text: 'المزارع والريف', value: 0 },
                    { text: 'الجبال والوديان', value: 0 }
                ]
            },
            {
                type: 'naturalist',
                questionType: 'rating',
                question: 'قيّم قوتك في هذه المهارات الطبيعية (1-5 نجوم):',
                statements: [
                    { text: 'تمييز أنواع النباتات', value: 0 },
                    { text: 'ملاحظة التغيرات في الطقس', value: 0 },
                    { text: 'فهم دورات الطبيعة', value: 0 },
                    { text: 'التنبؤ بالظواهر الطبيعية', value: 0 }
                ]
            },
            {
                type: 'naturalist',
                questionType: 'rating',
                question: 'قيّم أهمية هذه القضايا بالنسبة لك (1-5 نجوم):',
                statements: [
                    { text: 'حماية البيئة والطبيعة', value: 0 },
                    { text: 'دراسة الكائنات الحية', value: 0 },
                    { text: 'الأنشطة الخارجية', value: 0 },
                    { text: 'الحفاظ على التنوع البيولوجي', value: 0 }
                ]
            },
            {
                type: 'naturalist',
                questionType: 'rating',
                question: 'قيّم مدى انطباق هذه العبارات عليك (1-5 نجوم):',
                statements: [
                    { text: 'أشعر بالسلام في الطبيعة', value: 0 },
                    { text: 'ألاحظ تفاصيل البيئة حولي', value: 0 },
                    { text: 'أهتم بالقضايا البيئية', value: 0 },
                    { text: 'أفضل الأماكن الطبيعية على المدن', value: 0 }
                ]
            }
        ];

        // متغيرات الحالة
        let currentUser = '';
        let currentQuestionIndex = 0;
        let answers = {};
        let startTime = Date.now();
        let timerInterval;

        // عناصر DOM
        const welcomeScreen = document.getElementById('welcome-screen');
        const onboardingScreen = document.getElementById('onboarding-screen');
        const testScreen = document.getElementById('test-screen');
        const resultsScreen = document.getElementById('results-screen');
        const userNameInput = document.getElementById('userName');
        const startBtn = document.getElementById('startBtn');
        const howItWorksBtn = document.getElementById('howItWorksBtn');
        const howItWorksModal = document.getElementById('howItWorksModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const startTestBtn = document.getElementById('startTestBtn');
        const midwayBreak = document.getElementById('midway-break');
        const continueTestBtn = document.getElementById('continueTestBtn');

        // أحداث الأزرار
        startBtn.addEventListener('click', function () {
            currentUser = '<%=name>'; // اسم ثابت
            showOnboarding();
        });

        howItWorksBtn.addEventListener('click', function () {
            howItWorksModal.classList.remove('hidden');
            howItWorksModal.classList.add('flex');
        });

        closeModalBtn.addEventListener('click', function () {
            howItWorksModal.classList.add('hidden');
            howItWorksModal.classList.remove('flex');
        });

        // أحداث نافذة الاختبار غير المكتمل
        document.getElementById('continueTestFromModal').addEventListener('click', function () {
            document.getElementById('incompleteTestModal').classList.add('hidden');
            // الانتقال لأول سؤال غير مُجاب عليه
            goToFirstUnansweredQuestion();
        });

        document.getElementById('showPartialResults').addEventListener('click', function () {
            document.getElementById('incompleteTestModal').classList.add('hidden');
            proceedWithResults();
        });

        document.getElementById('closeIncompleteModal').addEventListener('click', function () {
            document.getElementById('incompleteTestModal').classList.add('hidden');
        });

        // أحداث نافذة مراجعة الاختبار
        document.getElementById('proceedToResults').addEventListener('click', function () {
            document.getElementById('reviewTestModal').classList.add('hidden');
            proceedWithResults();
        });

        document.getElementById('reviewAnswers').addEventListener('click', function () {
            document.getElementById('reviewTestModal').classList.add('hidden');
            // الانتقال لأول سؤال غير مُجاب عليه أو السؤال الأول
            const firstUnanswered = findFirstUnansweredQuestion();
            if (firstUnanswered !== -1) {
                currentQuestionIndex = firstUnanswered;
            } else {
                currentQuestionIndex = 0;
            }
            showQuestion(currentQuestionIndex);
        });

        document.getElementById('closeReviewModal').addEventListener('click', function () {
            document.getElementById('reviewTestModal').classList.add('hidden');
        });

        startTestBtn.addEventListener('click', function () {
            startTest();
        });

        continueTestBtn.addEventListener('click', function () {
            midwayBreak.classList.add('hidden');
        });

        // إظهار شاشة الدليل السريع
        function showOnboarding() {
            welcomeScreen.classList.add('hidden');
            onboardingScreen.classList.remove('hidden');
        }

        // بدء الاختبار
        function startTest() {
            onboardingScreen.classList.add('hidden');
            testScreen.classList.remove('hidden');

            // إنشاء شريط التقدم
            createProgressTimeline();

            // بدء المؤقت
            startTimer();

            // عرض السؤال الأول
            showQuestion(0);
        }

        // إنشاء شريط التقدم التفاعلي
        function createProgressTimeline() {
            const timeline = document.getElementById('progressTimeline');
            timeline.innerHTML = '';

            for (let i = 1; i <= 40; i++) {
                const dot = document.createElement('div');
                const isAnswered = answers[i - 1] !== undefined;
                const isCurrent = i === currentQuestionIndex + 1;

                let className = 'w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs font-bold cursor-pointer transition-all ';

                if (isAnswered) {
                    className += 'bg-green-500 text-white border-green-500 hover:bg-green-600';
                } else if (isCurrent) {
                    className += 'bg-indigo-600 text-white border-indigo-600 animate-pulse';
                } else {
                    className += 'bg-white text-gray-400 border-gray-300 hover:border-gray-400';
                }

                dot.className = className;
                dot.textContent = i;
                dot.title = isAnswered ? 'تمت الإجابة' : (isCurrent ? 'السؤال الحالي' : 'لم تتم الإجابة');
                dot.addEventListener('click', () => goToQuestion(i - 1));
                timeline.appendChild(dot);
            }
        }

        // الانتقال لسؤال محدد
        function goToQuestion(index) {
            if (index >= 0 && index < questions.length) {
                currentQuestionIndex = index;
                showQuestion(index);
            }
        }

        // الانتقال لأول سؤال غير مُجاب عليه
        function goToFirstUnansweredQuestion() {
            for (let i = 0; i < questions.length; i++) {
                if (answers[i] === undefined) {
                    currentQuestionIndex = i;
                    showQuestion(i);
                    return;
                }
            }
        }

        // عرض شرح نوع السؤال
        function showQuestionTypeExplanation(questionType) {
            const explanationContainer = document.getElementById('questionTypeExplanation');
            let explanationHTML = '';

            switch (questionType) {
                case 'single':
                    explanationHTML = `
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">🎯</span>
                            <div>
                                <h4 class="font-semibold text-blue-800">اختيار واحد</h4>
                                <p class="text-sm text-blue-600">اختر الإجابة الأقرب لك من بين الخيارات</p>
                            </div>
                        </div>
                    `;
                    break;

                case 'multiple':
                    explanationHTML = `
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">☑️</span>
                            <div>
                                <h4 class="font-semibold text-blue-800">اختيار متعدد</h4>
                                <p class="text-sm text-blue-600">اختر كل ما ينطبق عليك، ثم اضغط "تأكيد الإجابة"</p>
                            </div>
                        </div>
                    `;
                    break;

                case 'ranking':
                    explanationHTML = `
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">📊</span>
                            <div>
                                <h4 class="font-semibold text-blue-800">ترتيب حسب التفضيل</h4>
                                <p class="text-sm text-blue-600">اسحب العناصر لترتيبها من الأكثر تفضيلاً إلى الأقل</p>
                            </div>
                        </div>
                    `;
                    break;

                case 'rating':
                    explanationHTML = `
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">⭐</span>
                            <div>
                                <h4 class="font-semibold text-blue-800">تقييم بالنجوم</h4>
                                <p class="text-sm text-blue-600">قيّم كل عبارة من 1 إلى 5 نجوم حسب انطباقها عليك</p>
                            </div>
                        </div>
                    `;
                    break;
            }

            explanationContainer.innerHTML = explanationHTML;
        }

        // عرض السؤال
        function showQuestion(index) {
            const question = questions[index];
            const intelligence = intelligences[question.type];
            const container = document.getElementById('questionContainer');

            // إضافة تأثير الخروج
            container.classList.add('question-transition', 'question-exit');

            setTimeout(() => {
                // تحديث معلومات الذكاء الحالي
                document.getElementById('currentIntelligenceIcon').textContent = intelligence.icon;
                document.getElementById('currentIntelligenceName').textContent = intelligence.name;

                // تحديث رقم السؤال والتقدم
                document.getElementById('currentQuestion').textContent = index + 1;
                const progress = ((index + 1) / 40) * 100;
                document.getElementById('progressPercent').textContent = Math.round(progress) + '%';

                // تحديث دائرة التقدم
                const circle = document.getElementById('progressCircle');
                const circumference = 2 * Math.PI * 20;
                const offset = circumference - (progress / 100) * circumference;
                circle.style.strokeDashoffset = offset;

                // تحديث النص التقدمي
                const answeredCount = Object.keys(answers).length;
                document.getElementById('progressText').textContent =
                    `تمت الإجابة على ${answeredCount} من 40 · المتبقي: ${40 - answeredCount} سؤالًا`;

                // تحديث شريط التقدم
                createProgressTimeline();

                // عرض شرح نوع السؤال
                showQuestionTypeExplanation(question.questionType);

                // عرض السؤال الجديد
                container.innerHTML = createQuestionHTML(question, index);

                // إضافة تأثير الدخول
                container.classList.remove('question-exit');
                container.classList.add('question-enter');

                setTimeout(() => {
                    container.classList.remove('question-enter');
                    container.classList.add('question-active');
                }, 50);

                // تحديث أزرار التنقل
                document.getElementById('prevBtn').disabled = index === 0;
                document.getElementById('nextBtn').disabled = !answers[index];

                // إضافة مستمعي الأحداث
                addQuestionEventListeners(question, index);

                // استراحة منتصف الطريق
                if (index === 20) {
                    showMidwayBreak();
                }
            }, 200);
        }

        // إنشاء HTML للسؤال
        function createQuestionHTML(question, index) {
            let html = `<h3 class="text-2xl md:text-3xl font-semibold mb-8 text-center leading-relaxed">${question.question}</h3>`;

            switch (question.questionType) {
                case 'single':
                    html += '<div class="space-y-3">';
                    question.options.forEach((option, i) => {
                        const checked = answers[index] === i ? 'checked' : '';
                        html += `
                            <label class="flex items-center p-6 border-2 rounded-xl cursor-pointer hover:bg-gray-50 transition-colors ${checked ? 'border-indigo-500 bg-indigo-50' : 'border-gray-200'}">
                                <input type="radio" name="q${index}" value="${i}" class="mr-4 w-5 h-5" ${checked}>
                                <span class="text-xl md:text-2xl leading-relaxed">${option.text}</span>
                            </label>
                        `;
                    });
                    html += '</div>';
                    break;

                case 'multiple':
                    html += '<div class="space-y-3">';
                    question.options.forEach((option, i) => {
                        const checked = answers[index] && answers[index].includes(i) ? 'checked' : '';
                        html += `
                            <label class="flex items-center p-6 border-2 rounded-xl cursor-pointer hover:bg-gray-50 transition-colors ${checked ? 'border-indigo-500 bg-indigo-50' : 'border-gray-200'}">
                                <input type="checkbox" name="q${index}" value="${i}" class="mr-4 w-5 h-5" ${checked}>
                                <span class="text-xl md:text-2xl leading-relaxed">${option.text}</span>
                            </label>
                        `;
                    });
                    html += '</div>';
                    html += `
                        <div class="text-center mt-6">
                            <button id="confirmMultipleBtn" class="bg-indigo-600 text-white px-8 py-3 rounded-lg hover:bg-indigo-700 transition-colors font-semibold disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                ✅ تأكيد الإجابة
                            </button>
                        </div>
                    `;
                    break;

                case 'ranking':
                    html += '<div id="rankingContainer" class="space-y-3">';
                    const currentRanking = answers[index] || [];
                    const itemsToRank = currentRanking.length > 0 ?
                        currentRanking.map(i => question.options[i]) :
                        [...question.options];

                    itemsToRank.forEach((option, i) => {
                        const originalIndex = question.options.indexOf(option);
                        html += `
                            <div class="ranking-item bg-white border-2 border-gray-200 rounded-xl p-4 hover:bg-gray-50 transition-colors" data-index="${originalIndex}">
                                <div class="flex items-center gap-4">
                                    <div class="flex flex-col gap-1">
                                        <button class="move-up-btn w-8 h-8 bg-blue-500 hover:bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-bold transition-colors ${i === 0 ? 'opacity-50 cursor-not-allowed' : ''}" 
                                                data-direction="up" data-item-index="${i}" ${i === 0 ? 'disabled' : ''}>
                                            ↑
                                        </button>
                                        <button class="move-down-btn w-8 h-8 bg-blue-500 hover:bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-bold transition-colors ${i === itemsToRank.length - 1 ? 'opacity-50 cursor-not-allowed' : ''}" 
                                                data-direction="down" data-item-index="${i}" ${i === itemsToRank.length - 1 ? 'disabled' : ''}>
                                            ↓
                                        </button>
                                    </div>
                                    <span class="w-12 h-12 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold text-xl rank-number">${i + 1}</span>
                                    <span class="text-xl md:text-2xl leading-relaxed flex-1">${option.text}</span>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                    html += `
                        <div class="text-center mt-6">
                            <button id="confirmRankingBtn" class="bg-indigo-600 text-white px-8 py-3 rounded-lg hover:bg-indigo-700 transition-colors font-semibold">
                                ✅ تأكيد الترتيب
                            </button>
                        </div>
                    `;
                    break;

                case 'rating':
                    html += '<div class="space-y-6">';
                    question.statements.forEach((statement, i) => {
                        const currentRating = answers[index] && answers[index][i] ? answers[index][i] : 0;
                        html += `
                            <div class="bg-gray-50 p-6 rounded-xl">
                                <p class="text-xl md:text-2xl mb-4 leading-relaxed">${statement.text}</p>
                                <div class="flex items-center gap-3">
                                    <span class="text-base text-gray-600 ml-3">ضعيف</span>
                                    <div class="flex gap-2" data-statement="${i}">
                        `;

                        for (let star = 1; star <= 5; star++) {
                            const filled = star <= currentRating ? 'text-yellow-400' : 'text-gray-300';
                            html += `
                                <button type="button" class="star-btn text-3xl hover:text-yellow-400 transition-colors ${filled}" 
                                        data-rating="${star}" data-statement="${i}">
                                    ★
                                </button>
                            `;
                        }

                        html += `
                                    </div>
                                    <span class="text-base text-gray-600 mr-3">قوي</span>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                    html += `
                        <div class="text-center mt-6">
                            <button id="confirmRatingBtn" class="bg-indigo-600 text-white px-8 py-3 rounded-lg hover:bg-indigo-700 transition-colors font-semibold disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                ✅ تأكيد التقييم
                            </button>
                        </div>
                    `;
                    break;
            }

            return html;
        }

        // إضافة مستمعي الأحداث للسؤال
        function addQuestionEventListeners(question, index) {
            switch (question.questionType) {
                case 'single':
                    document.querySelectorAll(`input[name="q${index}"]`).forEach(input => {
                        input.addEventListener('change', function () {
                            answers[index] = parseInt(this.value);
                            saveAnswer();
                            updateNavigationButtons();

                            // إظهار مؤشر الانتقال
                            showAutoAdvanceIndicator();

                            // الانتقال التلقائي للسؤال التالي بسرعة أكبر
                            setTimeout(() => {
                                hideAutoAdvanceIndicator();
                                if (currentQuestionIndex < questions.length - 1) {
                                    currentQuestionIndex++;
                                    showQuestion(currentQuestionIndex);
                                }
                            }, 300);
                        });
                    });
                    break;

                case 'multiple':
                    const confirmBtn = document.getElementById('confirmMultipleBtn');

                    document.querySelectorAll(`input[name="q${index}"]`).forEach(input => {
                        input.addEventListener('change', function () {
                            if (!answers[index]) answers[index] = [];

                            const value = parseInt(this.value);
                            if (this.checked) {
                                if (!answers[index].includes(value)) {
                                    answers[index].push(value);
                                }
                            } else {
                                answers[index] = answers[index].filter(v => v !== value);
                            }

                            // تفعيل/تعطيل زر التأكيد
                            confirmBtn.disabled = !answers[index] || answers[index].length === 0;

                            saveAnswer();
                            updateNavigationButtons();
                        });
                    });

                    // إضافة مستمع لزر التأكيد
                    confirmBtn.addEventListener('click', function () {
                        if (answers[index] && answers[index].length > 0) {
                            showAutoAdvanceIndicator();
                            setTimeout(() => {
                                hideAutoAdvanceIndicator();
                                if (currentQuestionIndex < questions.length - 1) {
                                    currentQuestionIndex++;
                                    showQuestion(currentQuestionIndex);
                                }
                            }, 300);
                        }
                    });

                    // تفعيل الزر إذا كانت هناك إجابة محفوظة
                    if (answers[index] && answers[index].length > 0) {
                        confirmBtn.disabled = false;
                    }
                    break;

                case 'ranking':
                    // حفظ الترتيب الافتراضي عند تحميل السؤال
                    saveDefaultRanking(index);

                    initializeSortable(index);

                    // إضافة مستمع لزر تأكيد الترتيب
                    const confirmRankingBtn = document.getElementById('confirmRankingBtn');
                    confirmRankingBtn.addEventListener('click', function () {
                        // التأكد من حفظ الترتيب الحالي
                        saveRankingAnswer(index);

                        showAutoAdvanceIndicator();
                        setTimeout(() => {
                            hideAutoAdvanceIndicator();
                            if (currentQuestionIndex < questions.length - 1) {
                                currentQuestionIndex++;
                                showQuestion(currentQuestionIndex);
                            }
                        }, 300);
                    });
                    break;

                case 'rating':
                    initializeRatingSystem(question, index);

                    // إضافة مستمع لزر تأكيد التقييم
                    const confirmRatingBtn = document.getElementById('confirmRatingBtn');
                    confirmRatingBtn.addEventListener('click', function () {
                        showAutoAdvanceIndicator();
                        setTimeout(() => {
                            hideAutoAdvanceIndicator();
                            if (currentQuestionIndex < questions.length - 1) {
                                currentQuestionIndex++;
                                showQuestion(currentQuestionIndex);
                            }
                        }, 300);
                    });
                    break;
            }
        }

        // تهيئة الترتيب بالسحب
        function initializeSortable(index) {
            const container = document.getElementById('rankingContainer');

            // إضافة مستمعي الأحداث لأزرار الحركة
            container.addEventListener('click', function (e) {
                if (e.target.classList.contains('move-up-btn') || e.target.classList.contains('move-down-btn')) {
                    const direction = e.target.dataset.direction;
                    const itemIndex = parseInt(e.target.dataset.itemIndex);
                    const items = Array.from(container.children);
                    const currentItem = items[itemIndex];

                    if (direction === 'up' && itemIndex > 0) {
                        // تحريك للأعلى
                        const previousItem = items[itemIndex - 1];
                        container.insertBefore(currentItem, previousItem);
                    } else if (direction === 'down' && itemIndex < items.length - 1) {
                        // تحريك للأسفل
                        const nextItem = items[itemIndex + 1];
                        container.insertBefore(nextItem, currentItem);
                    }

                    updateRankingNumbers();
                    updateMoveButtons();
                    saveRankingAnswer(index);
                }
            });
        }

        // تحديث أزرار الحركة
        function updateMoveButtons() {
            const container = document.getElementById('rankingContainer');
            const items = Array.from(container.children);

            items.forEach((item, index) => {
                const upBtn = item.querySelector('.move-up-btn');
                const downBtn = item.querySelector('.move-down-btn');

                // تحديث data-item-index
                upBtn.dataset.itemIndex = index;
                downBtn.dataset.itemIndex = index;

                // تعطيل/تفعيل الأزرار حسب الموقع
                if (index === 0) {
                    upBtn.disabled = true;
                    upBtn.classList.add('opacity-50', 'cursor-not-allowed');
                } else {
                    upBtn.disabled = false;
                    upBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }

                if (index === items.length - 1) {
                    downBtn.disabled = true;
                    downBtn.classList.add('opacity-50', 'cursor-not-allowed');
                } else {
                    downBtn.disabled = false;
                    downBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            });
        }

        // تحديث أرقام الترتيب
        function updateRankingNumbers() {
            const items = document.querySelectorAll('.ranking-item');
            items.forEach((item, i) => {
                const numberSpan = item.querySelector('span');
                numberSpan.textContent = i + 1;
            });
        }

        // تحديث أرقام الترتيب
        function updateRankingNumbers() {
            const items = document.querySelectorAll('.ranking-item');
            items.forEach((item, i) => {
                const numberSpan = item.querySelector('span');
                numberSpan.textContent = i + 1;
            });
        }

        // حفظ إجابة الترتيب
        function saveRankingAnswer(index) {
            const items = document.querySelectorAll('.ranking-item');
            answers[index] = Array.from(items).map(item => parseInt(item.dataset.index));
            saveAnswer();
            updateNavigationButtons();
        }
        function saveDefaultRanking(index) {
            if (!answers[index]) {
                // إذا لم تكن هناك إجابة محفوظة، احفظ الترتيب الافتراضي
                answers[index] = [0, 1, 2, 3]; // الترتيب الأصلي
                saveAnswer();
                updateNavigationButtons();
            }
        }

        // تهيئة نظام التقييم بالنجوم
        function initializeRatingSystem(question, index) {
            const starButtons = document.querySelectorAll('.star-btn');

            starButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const rating = parseInt(this.dataset.rating);
                    const statementIndex = parseInt(this.dataset.statement);

                    // تهيئة مصفوفة الإجابات إذا لم تكن موجودة
                    if (!answers[index]) {
                        answers[index] = new Array(question.statements.length).fill(0);
                    }

                    // حفظ التقييم
                    answers[index][statementIndex] = rating;

                    // تحديث النجوم بصرياً
                    const statementStars = document.querySelectorAll(`[data-statement="${statementIndex}"] .star-btn`);
                    statementStars.forEach((star, i) => {
                        if (i < rating) {
                            star.classList.remove('text-gray-300');
                            star.classList.add('text-yellow-400');
                        } else {
                            star.classList.remove('text-yellow-400');
                            star.classList.add('text-gray-300');
                        }
                    });

                    saveAnswer();
                    updateNavigationButtons();

                    // التحقق من اكتمال جميع التقييمات وتفعيل زر التأكيد
                    const allRated = answers[index].every(rating => rating > 0);
                    const confirmBtn = document.getElementById('confirmRatingBtn');
                    if (confirmBtn) {
                        confirmBtn.disabled = !allRated;
                    }
                });
            });

            // تفعيل الزر إذا كانت هناك إجابة محفوظة مسبقاً
            if (answers[index] && answers[index].every(rating => rating > 0)) {
                const confirmBtn = document.getElementById('confirmRatingBtn');
                if (confirmBtn) {
                    confirmBtn.disabled = false;
                }
            }
        }

        // حفظ الإجابة وإظهار رسالة
        function saveAnswer() {
            const message = document.getElementById('autoSaveMessage');
            message.style.opacity = '1';
            setTimeout(() => {
                message.style.opacity = '0';
            }, 2000);
        }

        // إظهار مؤشر الانتقال التلقائي
        function showAutoAdvanceIndicator() {
            const indicator = document.getElementById('autoAdvanceIndicator');
            indicator.style.opacity = '1';
        }

        // إخفاء مؤشر الانتقال التلقائي
        function hideAutoAdvanceIndicator() {
            const indicator = document.getElementById('autoAdvanceIndicator');
            indicator.style.opacity = '0';
        }

        // تحديث أزرار التنقل
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const finishBtn = document.getElementById('finishTestBtn');

            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.disabled = !answers[currentQuestionIndex];

            // إظهار زر الإنهاء إذا تم الإجابة على 75% من الأسئلة على الأقل
            const answeredCount = Object.keys(answers).length;
            const completionPercentage = (answeredCount / questions.length) * 100;

            if (completionPercentage >= 75) {
                finishBtn.classList.remove('hidden');
            } else {
                finishBtn.classList.add('hidden');
            }

            // تحديث نص زر التالي في السؤال الأخير
            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.textContent = '🏁 إنهاء الاختبار';
                nextBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                nextBtn.classList.add('bg-green-600', 'hover:bg-green-700');
            } else {
                nextBtn.textContent = 'التالي';
                nextBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                nextBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
            }
        }

        // أحداث أزرار التنقل
        document.getElementById('prevBtn').addEventListener('click', function () {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion(currentQuestionIndex);
            }
        });

        document.getElementById('nextBtn').addEventListener('click', function () {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion(currentQuestionIndex);
            } else {
                showReviewModal();
            }
        });

        // زر إنهاء الاختبار
        document.getElementById('finishTestBtn').addEventListener('click', function () {
            showReviewModal();
        });

        // زر الأسئلة غير المجابة
        document.getElementById('goToUnansweredBtn').addEventListener('click', function () {
            goToFirstUnansweredQuestion();
        });

        // بدء المؤقت
        function startTimer() {
            timerInterval = setInterval(function () {
                const elapsed = Date.now() - startTime;
                const minutes = Math.floor(elapsed / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                document.getElementById('timerDisplay').textContent =
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // إظهار استراحة منتصف الطريق
        function showMidwayBreak() {
            midwayBreak.classList.remove('hidden');

            // تمرين التنفس
            let breathCount = 0;
            const breathingText = document.getElementById('breathingText');

            const breathingInterval = setInterval(function () {
                if (breathCount < 5) { // 5 دورات تنفس
                    if (breathCount % 2 === 0) {
                        breathingText.textContent = `شهيق... ${4 - (breathCount % 4)}`;
                    } else {
                        breathingText.textContent = `زفير... ${4 - (breathCount % 4)}`;
                    }
                    breathCount++;
                } else {
                    clearInterval(breathingInterval);
                    breathingText.textContent = 'جاهز للمتابعة!';
                }
            }, 1000);
        }

        // حساب النتائج
        function calculateResults() {
            const scores = {};
            const maxScores = {};

            // تهيئة النقاط والحد الأقصى لكل نوع ذكاء
            Object.keys(intelligences).forEach(type => {
                scores[type] = 0;
                maxScores[type] = 0;
            });

            // حساب النقاط والحد الأقصى لكل سؤال
            questions.forEach((question, index) => {
                const questionType = question.type;

                // حساب الحد الأقصى للسؤال
                switch (question.questionType) {
                    case 'single':
                        const maxSingleValue = Math.max(...question.options.map(opt => opt.value));
                        maxScores[questionType] += maxSingleValue;
                        break;

                    case 'multiple':
                        const totalMultipleValue = question.options.reduce((sum, opt) => sum + opt.value, 0);
                        maxScores[questionType] += totalMultipleValue;
                        break;

                    case 'ranking':
                        maxScores[questionType] += 10; // 4+3+2+1 = 10 نقاط كحد أقصى
                        break;

                    case 'rating':
                        maxScores[questionType] += question.statements.length * 5; // 5 نجوم لكل عبارة
                        break;
                }

                // حساب النقاط الفعلية إذا تم الإجابة على السؤال
                if (answers[index] !== undefined) {
                    const answer = answers[index];

                    switch (question.questionType) {
                        case 'single':
                            if (question.options[answer]) {
                                scores[questionType] += question.options[answer].value;
                            }
                            break;

                        case 'multiple':
                            if (Array.isArray(answer)) {
                                answer.forEach(optionIndex => {
                                    if (question.options[optionIndex]) {
                                        scores[questionType] += question.options[optionIndex].value;
                                    }
                                });
                            }
                            break;

                        case 'ranking':
                            if (Array.isArray(answer)) {
                                answer.forEach((optionIndex, rank) => {
                                    scores[questionType] += (4 - rank); // الأول يحصل على 4، الثاني على 3، إلخ
                                });
                            }
                            break;

                        case 'rating':
                            if (Array.isArray(answer)) {
                                answer.forEach(rating => {
                                    scores[questionType] += rating; // إضافة التقييم مباشرة (1-5)
                                });
                            }
                            break;
                    }
                }
            });

            // تحويل النقاط إلى نسب مئوية دقيقة
            Object.keys(scores).forEach(type => {
                if (maxScores[type] > 0) {
                    scores[type] = Math.round((scores[type] / maxScores[type]) * 100);
                } else {
                    scores[type] = 0;
                }
                // التأكد من أن النسبة لا تتجاوز 100%
                scores[type] = Math.min(scores[type], 100);
            });

            return scores;
        }

        // إظهار نافذة مراجعة الاختبار
        function showReviewModal() {
            const totalQuestions = questions.length;
            const answeredQuestions = Object.keys(answers).length;

            // إنشاء ملخص الإجابات
            createReviewSummary();

            // إظهار الأسئلة غير المجابة إن وجدت
            if (answeredQuestions < totalQuestions) {
                showUnansweredQuestions();
            } else {
                document.getElementById('unansweredSection').classList.add('hidden');
            }

            document.getElementById('reviewTestModal').classList.remove('hidden');
            document.getElementById('reviewTestModal').classList.add('flex');
        }

        // إنشاء ملخص الإجابات
        function createReviewSummary() {
            const reviewSummary = document.getElementById('reviewSummary');
            const intelligenceTypes = Object.keys(intelligences);

            reviewSummary.innerHTML = intelligenceTypes.map(type => {
                const intel = intelligences[type];
                const questionsOfType = questions.filter(q => q.type === type);
                const answeredOfType = questionsOfType.filter((q, index) => {
                    const questionIndex = questions.indexOf(q);
                    return answers[questionIndex] !== undefined;
                }).length;

                const percentage = questionsOfType.length > 0 ?
                    Math.round((answeredOfType / questionsOfType.length) * 100) : 0;

                return `
                    <div class="text-center p-3 bg-white rounded-lg border border-gray-200">
                        <div class="text-2xl mb-1">${intel.icon}</div>
                        <div class="text-xs font-semibold text-gray-700 mb-1">${intel.name}</div>
                        <div class="text-sm font-bold" style="color: ${intel.color}">
                            ${answeredOfType}/${questionsOfType.length}
                        </div>
                        <div class="text-xs text-gray-500">${percentage}%</div>
                    </div>
                `;
            }).join('');
        }

        // إظهار الأسئلة غير المجابة
        function showUnansweredQuestions() {
            const unansweredSection = document.getElementById('unansweredSection');
            const unansweredList = document.getElementById('unansweredList');

            const unanswered = [];
            for (let i = 0; i < questions.length; i++) {
                if (answers[i] === undefined) {
                    unanswered.push(i + 1);
                }
            }

            if (unanswered.length > 0) {
                unansweredSection.classList.remove('hidden');

                const displayList = unanswered.length <= 15 ?
                    unanswered.join('، ') :
                    unanswered.slice(0, 15).join('، ') + ` و${unanswered.length - 15} أسئلة أخرى`;

                unansweredList.innerHTML = `
                    <p class="mb-2">الأسئلة التالية لم تتم الإجابة عليها:</p>
                    <div class="bg-white rounded-lg p-3 border border-yellow-300">
                        <strong>أرقام الأسئلة:</strong> ${displayList}
                    </div>
                    <p class="mt-2 text-xs">💡 يمكنك الضغط على "مراجعة الإجابات" للعودة وإكمالها</p>
                `;
            }
        }

        // البحث عن أول سؤال غير مُجاب عليه
        function findFirstUnansweredQuestion() {
            for (let i = 0; i < questions.length; i++) {
                if (answers[i] === undefined) {
                    return i;
                }
            }
            return -1;
        }

        // عرض النتائج (الوظيفة القديمة محدثة)
        function showResults() {
            showReviewModal();
        }

        // إظهار نافذة الاختبار غير المكتمل
        function showIncompleteTestModal(answeredQuestions, totalQuestions) {
            const remainingQuestions = totalQuestions - answeredQuestions;
            const percentage = Math.round((answeredQuestions / totalQuestions) * 100);

            // العثور على أرقام الأسئلة غير المجابة
            const unansweredQuestions = [];
            for (let i = 0; i < totalQuestions; i++) {
                if (answers[i] === undefined) {
                    unansweredQuestions.push(i + 1);
                }
            }

            const unansweredList = unansweredQuestions.length <= 10 ?
                unansweredQuestions.join('، ') :
                unansweredQuestions.slice(0, 10).join('، ') + ` وأسئلة أخرى...`;

            document.getElementById('incompleteMessage').innerHTML = `
                تمت الإجابة على <strong>${answeredQuestions}</strong> من <strong>${totalQuestions}</strong> سؤالاً<br>
                <span class="text-sm text-gray-500">نسبة الإكمال: ${percentage}% • المتبقي: ${remainingQuestions} أسئلة</span><br>
                <div class="mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <div class="text-sm font-semibold text-yellow-800 mb-1">الأسئلة غير المجابة:</div>
                    <div class="text-sm text-yellow-700">${unansweredList}</div>
                </div>
            `;

            document.getElementById('incompleteTestModal').classList.remove('hidden');
            document.getElementById('incompleteTestModal').classList.add('flex');
        }

        // المتابعة مع النتائج
        function proceedWithResults() {
            const scores = calculateResults();
            // عرض اسم المستخدم
            document.getElementById('resultUserName').textContent = currentUser;

            // عرض ملخص نمط الذكاءات
            showIntelligencePattern(scores);

            // عرض أقل 3 ذكاءات
            showLowestIntelligences(scores);

            // إنشاء الرسم البياني
            createResultsChart(scores);

            // عرض أعلى 3 ذكاءات
            showTopIntelligences(scores);

            // عرض التفاصيل الكاملة
            showDetailedResults(scores);

            // عرض التوصيات الشخصية
            showPersonalRecommendations(scores);

            // عرض خطة التطوير
            showDevelopmentPlan(scores);

            var data = new URLSearchParams();
            data.append('data', JSON.stringify(scores));
            data.append('type', 'p3');
            fetch('http://127.0.0.1:3000/saveExam', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
                },
                body: data
            }).catch(() => {
                alert("حصلت مشكلة في حفظ البيانات قد تضطر الى اعادة الاختبار")
            }).finally(() => {
                clearInterval(timerInterval);
                testScreen.classList.add('hidden');
                resultsScreen.classList.remove('hidden');
            })
        }

        // عرض ملخص نمط الذكاءات
        function showIntelligencePattern(scores) {
            const intelligencePattern = document.getElementById('intelligencePattern');

            // ترتيب الذكاءات حسب النقاط
            const sortedIntelligences = Object.keys(scores)
                .map(key => ({
                    type: key,
                    score: scores[key],
                    ...intelligences[key]
                }))
                .sort((a, b) => b.score - a.score);

            // تحديد النمط العام
            const topThree = sortedIntelligences.slice(0, 3);
            const averageScore = Object.values(scores).reduce((sum, score) => sum + score, 0) / 8;

            let patternDescription = '';
            if (averageScore >= 70) {
                patternDescription = 'لديك توازن ممتاز في معظم أنواع الذكاءات! 🌟';
            } else if (averageScore >= 50) {
                patternDescription = 'لديك توزيع متوازن مع تميز في بعض المجالات 👍';
            } else {
                patternDescription = 'لديك نقاط قوة محددة يمكن التركيز عليها وتطويرها 💪';
            }

            intelligencePattern.innerHTML = `
                <div class="mb-6">
                    <p class="text-xl text-indigo-700 font-semibold mb-4">${patternDescription}</p>
                    <div class="bg-white rounded-xl p-4 border border-indigo-200">
                        <h4 class="font-semibold text-gray-800 mb-3">أقوى 3 ذكاءات لديك:</h4>
                        <div class="flex flex-wrap justify-center gap-4">
                            ${topThree.map((intel, index) => `
                                <div class="flex items-center gap-2 bg-gradient-to-r from-indigo-100 to-purple-100 px-4 py-2 rounded-full border border-indigo-300">
                                    <span class="text-2xl">${intel.icon}</span>
                                    <span class="font-semibold text-indigo-800">${intel.name}</span>
                                    <span class="bg-indigo-600 text-white px-2 py-1 rounded-full text-sm font-bold">${intel.score}%</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-4 md:grid-cols-8 gap-2">
                    ${sortedIntelligences.map(intel => `
                        <div class="text-center">
                            <div class="w-16 h-16 mx-auto mb-2 rounded-full flex items-center justify-center text-2xl" 
                                 style="background-color: ${intel.color}20; border: 2px solid ${intel.color}">
                                ${intel.icon}
                            </div>
                            <div class="text-xs font-bold" style="color: ${intel.color}">${intel.score}%</div>
                            <div class="text-xs text-gray-600 mt-1">${intel.name}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // عرض أقل 3 ذكاءات
        function showLowestIntelligences(scores) {
            const lowestIntelligences = document.getElementById('lowestIntelligences');

            // ترتيب الذكاءات من الأقل للأعلى
            const sortedIntelligences = Object.keys(scores)
                .map(key => ({
                    type: key,
                    score: scores[key],
                    ...intelligences[key],
                    details: intelligenceDetails[key]
                }))
                .sort((a, b) => a.score - b.score)
                .slice(0, 3);

            lowestIntelligences.innerHTML = sortedIntelligences.map((intel, index) => `
                <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-6 border-l-4 border-gray-400 hover:shadow-lg transition-shadow">
                    <div class="text-center mb-4">
                        <div class="text-4xl mb-2">${intel.icon}</div>
                        <h4 class="text-lg font-bold text-gray-800">${intel.name}</h4>
                        <div class="flex items-center justify-center gap-2 mt-2">
                            <div class="bg-gray-200 rounded-full h-3 w-20">
                                <div class="h-3 rounded-full bg-gray-400 transition-all duration-1000" style="width: ${intel.score}%"></div>
                            </div>
                            <span class="text-lg font-bold text-gray-600">${intel.score}%</span>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg p-4 mb-4">
                        <h5 class="font-semibold text-gray-700 mb-2 flex items-center gap-2">
                            <span class="text-sm">📝</span> ما هو؟
                        </h5>
                        <p class="text-sm text-gray-600 leading-relaxed">
                            ${intel.details.description.substring(0, 120)}...
                        </p>
                    </div>
                    
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h5 class="font-semibold text-blue-700 mb-3 flex items-center gap-2">
                            <span class="text-sm">🚀</span> كيفية التطوير
                        </h5>
                        <ul class="space-y-2">
                            ${intel.details.learningMethods.slice(0, 3).map(method => `
                                <li class="flex items-start gap-2 text-sm text-blue-700">
                                    <span class="text-blue-500 font-bold mt-0.5">•</span>
                                    <span>${method}</span>
                                </li>
                            `).join('')}
                        </ul>
                        
                        <div class="mt-3 pt-3 border-t border-blue-200">
                            <h6 class="font-semibold text-blue-600 mb-2 text-sm">أنشطة مقترحة:</h6>
                            <div class="flex flex-wrap gap-1">
                                ${intel.details.activities.slice(0, 2).map(activity => `
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">${activity}</span>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // عرض أعلى 3 ذكاءات
        function showTopIntelligences(scores) {
            const topIntelligences = document.getElementById('topIntelligences');

            // ترتيب الذكاءات حسب النقاط
            const sortedIntelligences = Object.keys(scores)
                .map(key => ({
                    type: key,
                    score: scores[key],
                    ...intelligences[key],
                    details: intelligenceDetails[key]
                }))
                .sort((a, b) => b.score - a.score)
                .slice(0, 3);

            topIntelligences.innerHTML = sortedIntelligences.map((intel, index) => {
                const medalColors = ['🥇', '🥈', '🥉'];
                const gradients = [
                    'from-yellow-50 to-amber-50 border-yellow-400',
                    'from-gray-50 to-slate-50 border-gray-400',
                    'from-orange-50 to-amber-50 border-orange-400'
                ];

                return `
                    <div class="bg-gradient-to-r ${gradients[index]} rounded-xl border-l-4 p-6 shadow-lg">
                        <div class="flex items-center mb-4">
                            <div class="text-4xl mr-4">${medalColors[index]}</div>
                            <div class="text-4xl mr-4">${intel.icon}</div>
                            <div class="flex-1">
                                <h4 class="text-xl font-bold text-gray-800">${intel.name}</h4>
                                <div class="flex items-center gap-2 mt-2">
                                    <div class="bg-gray-200 rounded-full h-4 flex-1">
                                        <div class="h-4 rounded-full transition-all duration-1000" style="width: ${intel.score}%; background-color: ${intel.color}"></div>
                                    </div>
                                    <span class="text-xl font-bold" style="color: ${intel.color}">${intel.score}%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg p-4 mb-4">
                            <p class="text-gray-700 leading-relaxed">${intel.details.description}</p>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="bg-white rounded-lg p-3">
                                <h5 class="font-semibold text-green-700 mb-2 flex items-center gap-2">
                                    <span>💪</span> نقاط القوة
                                </h5>
                                <ul class="text-sm text-gray-700 space-y-1">
                                    ${intel.details.strengths.slice(0, 2).map(strength => `<li>• ${strength}</li>`).join('')}
                                </ul>
                            </div>
                            
                            <div class="bg-white rounded-lg p-3">
                                <h5 class="font-semibold text-blue-700 mb-2 flex items-center gap-2">
                                    <span>💼</span> مهن مناسبة
                                </h5>
                                <ul class="text-sm text-gray-700 space-y-1">
                                    ${intel.details.careers.slice(0, 3).map(career => `<li>• ${career}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // عرض التفاصيل الكاملة
        function showDetailedResults(scores) {
            const detailedResults = document.getElementById('detailedResults');

            // ترتيب جميع الذكاءات حسب النقاط
            const sortedIntelligences = Object.keys(scores)
                .map(key => ({
                    type: key,
                    score: scores[key],
                    ...intelligences[key],
                    details: intelligenceDetails[key]
                }))
                .sort((a, b) => b.score - a.score);

            detailedResults.innerHTML = sortedIntelligences.map((intel, index) => {
                const isTopThree = index < 3;
                const borderClass = isTopThree ? 'border-l-4' : 'border-l-2';
                const bgClass = isTopThree ? 'from-indigo-50 to-purple-50' : 'from-gray-50 to-white';

                return `
                    <div class="bg-gradient-to-r ${bgClass} rounded-xl ${borderClass} p-6 shadow-lg transition-all hover:shadow-xl" style="border-color: ${intel.color}">
                        <!-- Header -->
                        <div class="flex items-center mb-6">
                            <div class="text-4xl mr-4">${intel.icon}</div>
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <h4 class="text-2xl font-bold" style="color: ${intel.color}">${intel.name}</h4>
                                    ${isTopThree ? `<span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-semibold">أعلى ${index + 1}</span>` : ''}
                                </div>
                                <div class="flex items-center gap-3">
                                    <div class="bg-gray-200 rounded-full h-5 flex-1">
                                        <div class="h-5 rounded-full transition-all duration-1000" style="width: ${intel.score}%; background-color: ${intel.color}"></div>
                                    </div>
                                    <span class="text-2xl font-bold" style="color: ${intel.color}">${intel.score}%</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Description -->
                        <div class="bg-white rounded-lg p-4 mb-6 border border-gray-100">
                            <h5 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                <span class="text-lg">📝</span> وصف هذا النوع من الذكاء
                            </h5>
                            <p class="text-gray-700 leading-relaxed">${intel.details.description}</p>
                        </div>
                        
                        <!-- Details Grid -->
                        <div class="grid md:grid-cols-2 gap-6">
                            <!-- Learning Methods -->
                            <div class="bg-white rounded-lg p-4 border border-gray-100">
                                <h5 class="font-semibold text-green-700 mb-3 flex items-center gap-2">
                                    <span class="text-lg">📚</span> طرق التعلم المناسبة
                                </h5>
                                <ul class="space-y-2">
                                    ${intel.details.learningMethods.map(method => `
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <span class="text-green-500 font-bold mt-1">•</span>
                                            <span>${method}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                            
                            <!-- Activities -->
                            <div class="bg-white rounded-lg p-4 border border-gray-100">
                                <h5 class="font-semibold text-blue-700 mb-3 flex items-center gap-2">
                                    <span class="text-lg">🎯</span> أنشطة وهوايات مقترحة
                                </h5>
                                <ul class="space-y-2">
                                    ${intel.details.activities.map(activity => `
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <span class="text-blue-500 font-bold mt-1">•</span>
                                            <span>${activity}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                            
                            <!-- Careers -->
                            <div class="bg-white rounded-lg p-4 border border-gray-100">
                                <h5 class="font-semibold text-purple-700 mb-3 flex items-center gap-2">
                                    <span class="text-lg">💼</span> مهن وتخصصات مناسبة
                                </h5>
                                <div class="flex flex-wrap gap-2">
                                    ${intel.details.careers.map(career => `
                                        <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium">${career}</span>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- Strengths -->
                            <div class="bg-white rounded-lg p-4 border border-gray-100">
                                <h5 class="font-semibold text-orange-700 mb-3 flex items-center gap-2">
                                    <span class="text-lg">💪</span> نقاط القوة الرئيسية
                                </h5>
                                <ul class="space-y-2">
                                    ${intel.details.strengths.map(strength => `
                                        <li class="flex items-start gap-2 text-gray-700">
                                            <span class="text-orange-500 font-bold mt-1">•</span>
                                            <span>${strength}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        </div>
                        
                        ${isTopThree ? `
                            <div class="mt-6 bg-gradient-to-r from-yellow-50 to-amber-50 border border-yellow-200 rounded-lg p-4">
                                <h5 class="font-semibold text-amber-800 mb-2 flex items-center gap-2">
                                    <span class="text-lg">💡</span> نصائح خاصة لتطوير هذا الذكاء
                                </h5>
                                <p class="text-amber-700 text-sm leading-relaxed">
                                    هذا أحد أقوى أنواع الذكاء لديك! ركز على الأنشطة والمهن المذكورة أعلاه، واستخدم طرق التعلم المناسبة لتحقيق أفضل النتائج في دراستك وعملك.
                                </p>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // عرض التوصيات الشخصية
        function showPersonalRecommendations(scores) {
            const personalRecommendations = document.getElementById('personalRecommendations');

            // الحصول على أعلى 3 ذكاءات
            const topThree = Object.keys(scores)
                .map(key => ({
                    type: key,
                    score: scores[key],
                    ...intelligences[key],
                    details: intelligenceDetails[key]
                }))
                .sort((a, b) => b.score - a.score)
                .slice(0, 3);

            // جمع التوصيات من أعلى 3 ذكاءات
            const allLearningMethods = [...new Set(topThree.flatMap(intel => intel.details.learningMethods))];
            const allActivities = [...new Set(topThree.flatMap(intel => intel.details.activities))];
            const allCareers = [...new Set(topThree.flatMap(intel => intel.details.careers))];

            personalRecommendations.innerHTML = `
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <h4 class="text-xl font-bold text-indigo-800 mb-4 flex items-center gap-2">
                        <span class="text-2xl">📚</span> طرق التعلم الأنسب لك
                    </h4>
                    <div class="space-y-3">
                        ${allLearningMethods.slice(0, 6).map(method => `
                            <div class="flex items-center gap-3 p-3 bg-indigo-50 rounded-lg">
                                <span class="w-2 h-2 bg-indigo-500 rounded-full"></span>
                                <span class="text-gray-700">${method}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <h4 class="text-xl font-bold text-green-800 mb-4 flex items-center gap-2">
                        <span class="text-2xl">🎯</span> أنشطة مقترحة لك
                    </h4>
                    <div class="space-y-3">
                        ${allActivities.slice(0, 6).map(activity => `
                            <div class="flex items-center gap-3 p-3 bg-green-50 rounded-lg">
                                <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                <span class="text-gray-700">${activity}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-lg md:col-span-2">
                    <h4 class="text-xl font-bold text-purple-800 mb-4 flex items-center gap-2">
                        <span class="text-2xl">💼</span> مجالات مهنية مناسبة لك
                    </h4>
                    <div class="grid md:grid-cols-3 gap-3">
                        ${allCareers.slice(0, 12).map(career => `
                            <div class="bg-purple-50 border border-purple-200 rounded-lg p-3 text-center">
                                <span class="text-purple-800 font-medium">${career}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // عرض خطة التطوير
        function showDevelopmentPlan(scores) {
            const developmentPlan = document.getElementById('developmentPlan');

            // الحصول على أعلى 3 ذكاءات
            const topThree = Object.keys(scores)
                .map(key => ({
                    type: key,
                    score: scores[key],
                    ...intelligences[key],
                    details: intelligenceDetails[key]
                }))
                .sort((a, b) => b.score - a.score)
                .slice(0, 3);

            // الحصول على أقل 2 ذكاءات للتطوير
            const bottomTwo = Object.keys(scores)
                .map(key => ({
                    type: key,
                    score: scores[key],
                    ...intelligences[key],
                    details: intelligenceDetails[key]
                }))
                .sort((a, b) => a.score - b.score)
                .slice(0, 2);

            developmentPlan.innerHTML = `
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <h4 class="text-xl font-bold text-green-800 mb-4 flex items-center gap-2">
                        <span class="text-2xl">🚀</span> استثمر نقاط قوتك
                    </h4>
                    <p class="text-gray-600 mb-4">ركز على تطوير هذه الذكاءات القوية لديك:</p>
                    <div class="space-y-4">
                        ${topThree.map((intel, index) => `
                            <div class="border-l-4 pl-4" style="border-color: ${intel.color}">
                                <div class="flex items-center gap-3 mb-2">
                                    <span class="text-2xl">${intel.icon}</span>
                                    <h5 class="font-semibold" style="color: ${intel.color}">${intel.name} (${intel.score}%)</h5>
                                </div>
                                <ul class="text-sm text-gray-700 space-y-1">
                                    ${intel.details.activities.slice(0, 2).map(activity => `<li>• ${activity}</li>`).join('')}
                                </ul>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <h4 class="text-xl font-bold text-orange-800 mb-4 flex items-center gap-2">
                        <span class="text-2xl">💪</span> طور نقاط الضعف
                    </h4>
                    <p class="text-gray-600 mb-4">هذه المجالات تحتاج لمزيد من التطوير:</p>
                    <div class="space-y-4">
                        ${bottomTwo.map(intel => `
                            <div class="border-l-4 border-gray-300 pl-4">
                                <div class="flex items-center gap-3 mb-2">
                                    <span class="text-2xl">${intel.icon}</span>
                                    <h5 class="font-semibold text-gray-700">${intel.name} (${intel.score}%)</h5>
                                </div>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    ${intel.details.learningMethods.slice(0, 2).map(method => `<li>• جرب: ${method}</li>`).join('')}
                                </ul>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200 md:col-span-2">
                    <h4 class="text-xl font-bold text-blue-800 mb-4 flex items-center gap-2">
                        <span class="text-2xl">📋</span> خطة عمل لمدة 30 يوماً
                    </h4>
                    <div class="grid md:grid-cols-3 gap-4">
                        <div class="bg-white rounded-lg p-4">
                            <h5 class="font-semibold text-green-700 mb-3">الأسبوع الأول</h5>
                            <ul class="text-sm text-gray-700 space-y-2">
                                <li>• ابدأ بنشاط واحد من نقاط قوتك</li>
                                <li>• اقرأ عن أعلى ذكاء لديك</li>
                                <li>• جرب طريقة تعلم جديدة</li>
                            </ul>
                        </div>
                        <div class="bg-white rounded-lg p-4">
                            <h5 class="font-semibold text-blue-700 mb-3">الأسبوع الثاني-الثالث</h5>
                            <ul class="text-sm text-gray-700 space-y-2">
                                <li>• طبق طرق التعلم المناسبة لك</li>
                                <li>• ابدأ هواية جديدة من قائمة الأنشطة</li>
                                <li>• اعمل على تطوير نقطة ضعف واحدة</li>
                            </ul>
                        </div>
                        <div class="bg-white rounded-lg p-4">
                            <h5 class="font-semibold text-purple-700 mb-3">الأسبوع الرابع</h5>
                            <ul class="text-sm text-gray-700 space-y-2">
                                <li>• قيّم تقدمك</li>
                                <li>• ابحث عن فرص مهنية مناسبة</li>
                                <li>• ضع خطة للشهر القادم</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        // إنشاء الرسم البياني
        function createResultsChart(scores) {
            const ctx = document.getElementById('resultsChart').getContext('2d');

            const labels = Object.keys(intelligences).map(key => intelligences[key].name);
            const data = Object.keys(intelligences).map(key => scores[key]);
            const colors = Object.keys(intelligences).map(key => intelligences[key].color);

            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'نسبة الذكاء',
                        data: data,
                        backgroundColor: 'rgba(79, 70, 229, 0.2)',
                        borderColor: 'rgba(79, 70, 229, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: colors,
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    }
                }
            });
        }

        // أحداث أزرار الإجراءات
        function setupActionButtons() {
            // زر تحميل PDF
            const downloadBtn = document.getElementById('downloadPdfBtn');
            if (downloadBtn) {
                downloadBtn.addEventListener('click', function () {
                    alert('ميزة تحميل PDF ستكون متاحة قريباً!');
                });
            }



            // زر إعادة الاختبار
            const retakeBtn = document.getElementById('retakeBtn');
            if (retakeBtn) {
                retakeBtn.addEventListener('click', function () {
                    location.reload();
                });
            }
        }

        // تهيئة الأحداث عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function () {
            setupActionButtons();
        });
    </script>
    <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'9803f8a7a36f0d4b',t:'MTc1ODA2MzUzNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>